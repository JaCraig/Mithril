(function(s,a){typeof exports=="object"&&typeof module<"u"?module.exports=a(require("vue"),require("moment")):typeof define=="function"&&define.amd?define(["vue","moment"],a):(s=typeof globalThis<"u"?globalThis:s||self,s.admin=a(s.Vue,s.moment))})(this,function(s,a){"use strict";var I=Object.defineProperty;var P=(s,a,u)=>a in s?I(s,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[a]=u;var y=(s,a,u)=>(P(s,typeof a!="symbol"?a+"":a,u),u);const u=s.defineComponent({name:"settings-editor-component"}),p=(t,e)=>{const n=t.__vccOpts||t;for(const[r,i]of e)n[r]=i;return n};function g(t,e,n,r,i,c){return s.openBlock(),s.createElementBlock("div",null,"Settings Editor")}const E=p(u,[["render",g]]),w=s.defineComponent({name:"entity-editor-component"});function v(t,e,n,r,i,c){return s.openBlock(),s.createElementBlock("div",null,"Entity Editor")}const b=p(w,[["render",v]]);class f{constructor(e,n,r){this.DBName=e,this.Version=r;let i=indexedDB.open(e,r);i.onupgradeneeded=c=>{this.database=c.target.result;for(let d=0;d<n.length;++d){let h=n[d];this.database.objectStoreNames.contains(h)&&this.database.deleteObjectStore(h),this.database.createObjectStore(h)}},i.onsuccess=c=>{this.database=c.target.result}}openDatabase(e){let n=indexedDB.open(this.DBName,this.Version);n.onsuccess=r=>(this.database=r.target.result,e(this))}add(e,n,r){this.database.transaction(e,"readwrite").objectStore(e).put(n,r)}remove(e,n){this.database.transaction(e,"readwrite").objectStore(e).delete(n)}getByKey(e,n,r){let i=this.database.transaction(e,"readwrite").objectStore(e).get(n);i.onsuccess=r}getKeys(e,n){let r=this.database.transaction(e,"readwrite").objectStore(e).getAllKeys();r.onsuccess=n}get(e,n,r){let i=this.database.transaction(e,"readwrite").objectStore(e).get(n);i.onsuccess=r}getAll(e,n,r){let i=this.database.transaction(e,"readwrite").objectStore(e).getAll(r);i.onsuccess=n}}class o{constructor(e,n,r){this.url=n,this.method=e.toUpperCase(),this.data=r,this.headers=new Headers,this.method!=="GET"&&this.method!=="HEAD"&&this.method!=="DELETE"&&this.method!=="TRACE"&&this.type("application/json"),this.accept("application/json"),this.parser=i=>i.json(),this.serializer=i=>JSON.stringify(i),this.storageMode=2,this.databaseName="MithrilStorage",this.cacheKey=this.url+this.serializer(this.data),this.credentials="same-origin"}static get(e,n){return o.makeRequest("GET",e,n)}static makeRequest(e,n,r){return new o(e,n,r)}static post(e,n){return o.makeRequest("POST",e,n)}static put(e,n){return o.makeRequest("PUT",e,n)}static delete(e,n){return o.makeRequest("DELETE",e,n)}onSuccess(e){return this.success=e,this}onError(e){return this.error=e,this}setHeader(e,n){return this.headers.set(e,n),this}setCacheKey(e){return this.cacheKey=e,this}setCredentials(e){return this.credentials=e,this}type(e){return this.setHeader("Content-Type",e)}accept(e){return this.setHeader("Accept",e)}setParser(e){return this.parser=e,this}setMode(e,n="MithrilStorage"){return this.databaseName=n,this.storageMode=e,this}setSerializer(e){return this.serializer=e,this}send(){(this.error===void 0||this.error===null)&&(this.error=n=>{}),(this.success===void 0||this.success===null)&&(this.success=n=>{});let e=this.serializer(this.data);if(this.storageMode===1){o.returnValueFromDB(this.cacheKey,this.databaseName,this.success),this.queryNetwork(e,this.cacheKey,this.databaseName,n=>{},n=>{o.saveValueToDB(n,this.cacheKey,this.databaseName)});return}if(this.storageMode===3){o.returnValueFromDB(this.cacheKey,this.databaseName,this.success),this.queryNetwork(e,this.cacheKey,this.databaseName,n=>{},n=>{o.saveValueToDB(n,this.cacheKey,this.databaseName),this.success(n)});return}if(this.storageMode===0){this.queryNetwork(e,this.cacheKey,this.databaseName,this.success,n=>{o.saveValueToDB(n,this.cacheKey,this.databaseName),this.success(n)});return}this.queryNetwork(e,this.cacheKey,this.databaseName,n=>{},this.success)}static saveValueToDB(e,n,r){new f(r,["cache","cacheExpirations"],1).openDatabase(i=>{e!==void 0&&(i.add("cache",e,n),i.add("cacheExpirations",Date.now(),n))})}queryNetwork(e,n,r,i,c){if(!navigator.onLine){this.storageMode===0&&o.returnValueFromDB(n,r,i);return}fetch(this.url,{credentials:this.credentials,method:this.method,body:e,headers:this.headers}).then(this.parser).then(c).catch(this.error)}static returnValueFromDB(e,n,r){new f(n,["cache","cacheExpirations"],1).openDatabase(i=>{i.getByKey("cache",e,c=>{let d=c.target.result;d!==void 0&&r(d)})})}}var m=(t=>(t[t.NetworkFirst=0]="NetworkFirst",t[t.StorageFirst=1]="StorageFirst",t[t.NetworkOnly=2]="NetworkOnly",t[t.StorageAndUpdate=3]="StorageAndUpdate",t))(m||{});const k=s.defineComponent({name:"admin-application",data:function(){return{editors:[]}},methods:{loadEditors:function(){let t=this;o.post("/api/query",{query:`query{
  editors {
    category
    componentDefinition {
      name
      schema
      scriptFile
    }
    description
    icon
    name
  }
}`}).onSuccess(e=>{t.editors=e.data.editors}).setMode(m.StorageAndUpdate).send()}},created:function(){console.log("Loading Editors"),this.loadEditors()}}),G="",N=t=>(s.pushScopeId("data-v-bc7d62b0"),t=t(),s.popScopeId(),t),A={class:"main-application"},B={class:"left-nav"},S=N(()=>s.createElementVNode("div",null,[s.createElementVNode("pre",null,`
            `)],-1));function _(t,e,n,r,i,c){return s.openBlock(),s.createElementBlock("div",A,[s.createTextVNode(" Admin Application "),s.createElementVNode("div",B,[s.createTextVNode(" Left "),s.createElementVNode("pre",null,"                "+s.toDisplayString(t.editors)+`
            `,1)]),S])}const $=p(k,[["render",_],["__scopeId","data-v-bc7d62b0"]]);let l={mounted:function(t,e){if(l.onEventBound=l.onEvent.bind({el:t}),document.addEventListener("click",l.onEventBound),typeof e.value!="function")throw new Error("Argument must be a function");l.cb=e.value},cb:function(t){},onEvent:function(t){t.target===this.el||this.el.contains(t.target)||!l.cb||l.cb(t)},onEventBound:function(){},unbind:function(){document.removeEventListener("click",l.onEventBound)},update:function(t,e){if(typeof e.value!="function")throw new Error("Argument must be a function");l.cb=e.value}};function C(t){return t.directive("click-outside",l),t}function T(t){return t==null||(t.config.globalProperties.$filters={moment:function(e,n,r){return e==null?"N/A":(r??(r="YYYY-MM-DDThh:mm:ss"),n??(n="M-D-YYYY h:mm A"),a(e,r).format(n))},capitalize:function(e){return e==null?"":e.charAt(0).toUpperCase()+e.slice(1)},maxsize:function(e,n,r){return e==null?"":e.length<=n?e:(r??(r="..."),e.substring(0,n)+r)},currency:function(e,n,r){return e==null?"":(n??(n="en-US"),r??(r={style:"currency",currency:"USD"}),Intl.NumberFormat(n,r).format(e))}}),t}class D{}String.prototype.slugify=function(){return this.trim().replace(/ /g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"").replace(/([^a-zA-Z0-9-_/./:]+)/g,"")},String.prototype.stripHTML=function(){let t=document.createElement("div");return t.innerHTML=this,(t.textContent||t.innerText||"").replace(/^\s+|\s+$/g,"")},String.prototype.toNumber=function(){return this==null?0:parseFloat(this.stripHTML().replace(/[^0-9.-]/g,""))};const F=s.defineComponent({name:"DataHandler",data:function(){return{count:0,timer:0,internalData:this.model}},props:{model:{type:Object,default:{}},schema:{type:D,default:new D}},methods:{fetchData:function(){if(!this.schema.loadUrl)return;let t=this;o.post("/api/query",{query:t.schema.datalistQuery}).onSuccess(e=>{t.schema.datalist=e.data.dropDown}).setMode(m.StorageAndUpdate).send()},saveData:function(){},deleteData:function(){}},created:function(){if(!this.schema.datalistQuery)return;this.fetchData()},watch:{model:function(t,e){e!==t&&(this.internalModel=t)}}});function K(t,e,n,r,i,c){return s.openBlock(),s.createElementBlock("div",null,[s.createTextVNode(" ASDF "),(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(t.schema.children,d=>(s.openBlock(),s.createBlock(s.resolveDynamicComponent(d.type),{key:d.type,data:t.internalData,schema:d,onSave:t.saveData,onDelete:t.deleteData,onLoad:t.fetchData},null,40,["data","schema","onSave","onDelete","onLoad"]))),128)),s.createElementVNode("pre",null,s.toDisplayString(t.internalData),1)])}const j=p(F,[["render",K]]),L=s.defineComponent({data:function(){return{items:this.items,showDropDown:!1}},props:{items:Array},methods:{showDropDownFunc:function(){this.showDropDown=!0},hideDropDownFunc:function(){this.showDropDown=!1}},directives:{clickOutside:l}}),q={class:"unstyled"},M={class:"grouped"},z=["href"];function x(t,e,n,r,i,c){const d=s.resolveDirective("click-outside");return s.withDirectives((s.openBlock(),s.createElementBlock("ul",q,[s.createElementVNode("li",null,[s.createElementVNode("a",{class:"fas fa-circle-user",href:"#",onClick:e[0]||(e[0]=s.withModifiers((...h)=>t.showDropDownFunc&&t.showDropDownFunc(...h),["stop","prevent"]))}),s.createElementVNode("div",{class:s.normalizeClass({show:t.showDropDown,"z-depth-2":t.showDropDown,hidden:!t.showDropDown})},[s.createElementVNode("ul",M,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(t.items,h=>(s.openBlock(),s.createElementBlock("li",{key:h.display},[s.createElementVNode("a",{href:h.url,class:s.normalizeClass([h.icon])},s.toDisplayString(h.display),11,z)]))),128))])],2)])])),[[d,t.hideDropDownFunc]])}const H=p(L,[["render",x]]),U=t=>{t.component("mithril-data-handler",j),t.component("mithril-side-menu",H)},O={install:(t,e)=>{T(t),C(t),U(t)}};class Y{constructor(){y(this,"AdminApp");console.log("Admin loading"),this.AdminApp=this.SetupComponents(s.createApp({data:function(){return{}}})),this.AdminApp.mount("#AdminApplication"),console.log("Admin loaded")}SetupComponents(e){return e.use(O),e.component("admin-application",$),e.component("settings-editor-component",E),e.component("entity-editor-component",b),e}}return(()=>{new Y})()});
