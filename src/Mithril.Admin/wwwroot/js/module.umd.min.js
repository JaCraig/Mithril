(function(t,f){typeof exports=="object"&&typeof module<"u"?module.exports=f(require("vue"),require("moment"),require("showdown")):typeof define=="function"&&define.amd?define(["vue","moment","showdown"],f):(t=typeof globalThis<"u"?globalThis:t||self,t.admin=f(t.Vue,t.moment,t.showdown))})(this,function(t,f,v){"use strict";var gr=Object.defineProperty;var yr=(t,f,v)=>f in t?gr(t,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):t[f]=v;var te=(t,f,v)=>yr(t,typeof f!="symbol"?f+"":f,v);class ne{constructor(n){this.outputFormat=n??"[{Timestamp}]	[{Level}]	{Message}{Exception}"}format(n){return this.outputFormat.replace(/{(\w+)}/g,(a,r)=>r==="Timestamp"?n.timestamp.toISOString():r==="Level"?n.level:r==="Message"?n.message:r==="Exception"?n.exception?`
`+n.exception.stack:"":n.properties[r])}}class ae{constructor(n="Debug"){this.allowedLevels=["Verbose","Debug","Information","Warning","Error","Fatal"],this.minimumLevel=n,this.allowedLevels=this.allowedLevels.slice(this.allowedLevels.indexOf(n))}filter(n){return this.allowedLevels.indexOf(n.level)>=0}}class re{constructor(){this.styles={Verbose:"color: white;",Debug:"color: green",Information:"color: blue",Warning:"color: yellow",Error:"color: red",Fatal:"color: palevioletred"},this.consoleMethods={Verbose:(n,a,r)=>{console.log(n,a,r)},Debug:(n,a,r)=>{console.debug(n,a,r)},Information:(n,a,r)=>{console.info(n,a,r)},Warning:(n,a,r)=>{console.warn(n,a,r)},Error:(n,a,r)=>{console.error(n,a,r)},Fatal:(n,a,r)=>{console.error(n,a,r)}}}write(n){let a=n.args&&typeof n.args!="object",r=n.args&&typeof n.args=="object";this.consoleMethods[n.level]("%c"+n.message,this.styles[n.level],a?n.args:""),r&&console.table(n.args)}}class ${constructor(n){this.filters=[],this.enrichers=[],this.loggerConfiguration=n}writeTo(n){return this.sink=n,this.loggerConfiguration}minimumLevel(n){return this.filters.push(new ae(n)),this}filter(n){return this.filters.push(n),this}formatUsing(n){return this.formatter=n,this}enrichWith(n){return this.enrichers.push(n),this}process(n){this.formatter??(this.formatter=new ne),this.sink??(this.sink=new re);let a=Object.assign({},n);this.filters.some(r=>r.filter(a))&&(this.enrichers.forEach(r=>r.enrich(a)),a.message=this.formatter.format(a)||a.message,this.sink.write(a))}}class ie{constructor(){this.pipelines=[]}writeTo(n){let a=new $(this);return this.pipelines.push(a),a.writeTo(n)}minimumLevel(n){let a=new $(this);return this.pipelines.push(a),a.minimumLevel(n)}filter(n){let a=new $(this);return this.pipelines.push(a),a.filter(n)}formatUsing(n){let a=new $(this);return this.pipelines.push(a),a.formatUsing(n)}enrichWith(n){let a=new $(this);return this.pipelines.push(a),a.enrichWith(n)}write(n,a,r,o){let s={level:n,message:a,properties:{},exception:o,timestamp:new Date,args:r};this.pipelines.forEach(i=>i.process(s))}}class c{constructor(){}static configure(){return this.loggerConfiguration??(this.loggerConfiguration=window.LoggerConfiguration||new ie),window.LoggerConfiguration=this.loggerConfiguration,this.loggerConfiguration}static write(n,a,r,o){c.configure().write(n,a,r,o)}static verbose(n,a){this.write("Verbose",n,a)}static debug(n,a){this.write("Debug",n,a)}static information(n,a){this.write("Information",n,a)}static warning(n,a){this.write("Warning",n,a)}static error(n,a,r){this.write("Error",n,a,r)}static fatal(n,a,r){this.write("Fatal",n,a,r)}}class oe{constructor(n,a,r){this.dbName=n,this.tables=a,this.version=r;const o=indexedDB.open(n,r);o.onupgradeneeded=s=>{this.database=s.target.result;for(const i of a)this.database.objectStoreNames.contains(i)&&this.database.deleteObjectStore(i),this.database.createObjectStore(i)},o.onsuccess=s=>{this.database=s.target.result},o.onerror=s=>{c.error("Failed to open the database:",s.target.error)}}openDatabase(){return new Promise((n,a)=>{const r=indexedDB.open(this.dbName,this.version);r.onsuccess=o=>{this.database=o.target.result,n(this)},r.onerror=o=>{c.error("Failed to open the database:",o.target.error),a(new Error("Failed to open the database:"+o.target.error))}})}add(n,a,r){return new Promise((o,s)=>{const d=this.database.transaction(n,"readwrite").objectStore(n).put(a,r);d.onsuccess=()=>{o()},d.onerror=m=>{c.error("Failed to add an object to the database: ",m.target.error),s(new Error("Failed to add an object to the database: "+m.target.error))}})}remove(n,a){return new Promise((r,o)=>{const l=this.database.transaction(n,"readwrite").objectStore(n).delete(a);l.onsuccess=()=>{r()},l.onerror=d=>{c.error("Failed to remove an object from the database: ",d.target.error),o(new Error("Failed to remove an object from the database: "+d.target.error))}})}getByKey(n,a){return new Promise((r,o)=>{const l=this.database.transaction(n,"readwrite").objectStore(n).get(a);l.onsuccess=d=>{r(d.target.result)},l.onerror=d=>{c.error("Failed to retrieve an object from the database: ",d.target.error),o(new Error("Failed to retrieve an object from the database: "+d.target.error))}})}getKeys(n){return new Promise((a,r)=>{const i=this.database.transaction(n,"readwrite").objectStore(n).getAllKeys();i.onsuccess=l=>{a(l.target.result)},i.onerror=l=>{c.error("Failed to retrieve an object from the database: ",l.target.error),r(new Error("Failed to retrieve keys from the database: "+l.target.error))}})}get(n,a){return new Promise((r,o)=>{const l=this.database.transaction(n,"readwrite").objectStore(n).get(a);l.onsuccess=d=>{r(d.target.result)},l.onerror=d=>{c.error("Failed to retrieve an object from the database: ",d.target.error),o(new Error("Failed to retrieve an object from the database: "+d.target.error))}})}getAll(n,a){return new Promise((r,o)=>{const l=this.database.transaction(n,"readwrite").objectStore(n).getAll(a);l.onsuccess=d=>{r(d.target.result)},l.onerror=d=>{c.error("Failed to retrieve an object from the database: ",d.target.error),o(new Error("Failed to retrieve objects from the database: "+d.target.error))}})}}class z{constructor(){this.database=new oe("cacheStore",["cache","cacheEntryOptions"],1)}async clear(){await this.database.openDatabase();let n=await this.database.getAll("cacheEntryOptions"),a=await this.database.getAll("cache");for(let r=0;r<n.length;r++){let o=a[r];await this.remove(o.key)}return this}async getOptions(n){return await this.database.openDatabase(),this.database.getByKey("cacheEntryOptions",n)}async add(n,a,r){return await this.database.openDatabase(),await this.database.add("cache",n,a),await this.database.add("cacheEntryOptions",r,a),this}async remove(n){return await this.database.openDatabase(),await this.database.remove("cache",n),await this.database.remove("cacheEntryOptions",n),this}async get(n){return await this.database.openDatabase(),this.database.getByKey("cache",n)}async compact(){await this.database.openDatabase();let n=await this.database.getAll("cacheEntryOptions"),a=await this.database.getAll("cache"),r=new Date().getTime();for(let o=0;o<n.length;o++){let s=n[o],i=a[o];s.expirationTime!=0&&s.expirationTime<r&&await this.remove(i.key)}return this}}class T{constructor(){}static configure(n=new z){this.storageProvider??(this.storageProvider=window.StorageProvider||new z),window.StorageProvider=this.storageProvider}static async set(n,a,r={expirationTime:0,slidingExpirationTime:0,sliding:!1}){c.debug("Setting object in cache: ",{key:n,value:a,entryOptions:r}),this.configure(),await this.storageProvider.add(a,n,r)}static async get(n){c.debug("Getting object from cache: "+n),this.configure(),await this.storageProvider.compact();let a=await this.storageProvider.get(n);if(a==null)return a;let r=await this.storageProvider.getOptions(n);return r.sliding&&await this.set(n,a,{expirationTime:new Date().getTime()+r.slidingExpirationTime,slidingExpirationTime:r.slidingExpirationTime,sliding:!0}),a}static async remove(n){c.debug("Removing object from cache: "+n),this.configure(),await this.storageProvider.remove(n)}static async clear(){c.debug("Clearing cache"),this.configure(),await this.storageProvider.clear()}}class se{}class p{constructor(n){this.options={method:"GET",url:"",headers:{},credentials:"same-origin",serializer:JSON.stringify,parser:a=>a.json(),success:a=>{c.debug("Request response from "+this.options.url+":",a)},error:a=>{c.error("Request error from "+this.options.url+":",a)},retry:a=>{c.debug("Request retry on "+this.options.url+":",{attempt:a})},storageMode:0,cacheKey:"",timeout:6e4,retryAttempts:3,retryDelay:1e3},this.abortController=null,this.options={...this.options,...n}}static get(n,a){return new p({method:"GET",url:n,data:a,cacheKey:n+JSON.stringify(a)}).withHeaders({Accept:"application/json"})}static post(n,a){return new p({method:"POST",url:n,data:a,cacheKey:n+JSON.stringify(a),storageMode:2}).withHeaders({"Content-Type":"application/json",Accept:"application/json"})}static put(n,a){return new p({method:"PUT",url:n,data:a,cacheKey:n+JSON.stringify(a),storageMode:2}).withHeaders({"Content-Type":"application/json",Accept:"application/json"})}static delete(n,a){return new p({method:"DELETE",url:n,data:a,cacheKey:n+JSON.stringify(a),storageMode:2}).withHeaders({Accept:"application/json"})}static ofType(n,a,r){return new p({method:n,url:a,data:r,cacheKey:a+JSON.stringify(r)}).withHeaders({Accept:"application/json"})}withAuthenticationProvider(n){return this.options.authenticationProvider=n,this}withHeaders(n){return this.options.headers={...this.options.headers,...n},this}withCancellationToken(n){return this.options.cancellationToken=n,this}withCredentials(n){return this.options.credentials=n,this}withSerializer(n){return this.options.serializer=n,this}withParser(n){return this.options.parser=n,this}onSuccess(n){return this.options.success=n??(a=>{c.debug("Request response:",a)}),this}onError(n){return this.options.error=n??(a=>{c.error("Request error:",a)}),this}onRetry(n){return this.options.retry=n??(a=>{c.debug("Request retry:",{attempt:a})}),this}withStorageMode(n){return this.options.storageMode=n,this}withCacheKey(n){return this.options.cacheKey=n,this}withTimeout(n){return this.options.timeout=n??6e4,this}withRetryAttempts(n){return this.options.retryAttempts=n,this}withRetryDelay(n){return this.options.retryDelay=n,this}abort(){return this.abortController===null?this:(this.abortController.abort(),this.options.error(new Error("The request was aborted.")),this)}async send(){const{authenticationProvider:n,method:a,url:r,data:o,headers:s,credentials:i,serializer:l,parser:d,success:m,error:u,storageMode:E,cacheKey:L,timeout:hr,retryAttempts:pr,retryDelay:fr,retry:ur,cancellationToken:A}=this.options,V=new AbortController;this.abortController=V;let O=0,D=null;const ee=async()=>{if(E===1||E===3){const y=await T.get(L);if(y!==void 0&&(m(y),E===1))return y}if(!navigator.onLine){if(E===0){const S=await T.get(L);if(S!==void 0)return m(S),S}const y=new Error("System is offline");return u(y),Promise.reject(y)}try{const y=l(o);await(n==null?void 0:n.authenticate(this));const S=await Promise.race([fetch(r,{method:a,credentials:i,headers:s,body:y,signal:V.signal}),this.handleTimeout(hr)]);if(A!=null&&A.canceled)return Promise.reject(new Error("The request was canceled."));if(S.status>=200&&S.status<300){const P=await d(S);return m(P),E!==2&&await T.set(L,P),P}D=new Error(S.statusText),S.status===401&&await(n==null?void 0:n.authenticationFailed(this,S))}catch(y){D=y}return O<pr?(++O,await new Promise(y=>setTimeout(y,fr)),ur(O),ee()):(u(D),Promise.reject(D))};return ee()}async handleTimeout(n){throw n??(n=6e4),await new Promise((a,r)=>{setTimeout(()=>{r(new Error("Request timeout"))},n)}),new Error("Request timeout")}}var b=(e=>(e[e.NetworkFirst=0]="NetworkFirst",e[e.StorageFirst=1]="StorageFirst",e[e.NetworkOnly=2]="NetworkOnly",e[e.StorageAndUpdate=3]="StorageAndUpdate",e))(b||{});String.prototype.slugify=function(){return this.trim().replace(/ /g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"").replace(/([^a-zA-Z0-9-_/./:]+)/g,"")},String.prototype.stripHTML=function(){let e=document.createElement("div");return e.innerHTML=this,(e.textContent||e.innerText||"").replace(/^\s+|\s+$/g,"")},String.prototype.toNumber=function(){return this==null?0:parseFloat(this.stripHTML().replace(/[^0-9.-]/g,""))};function N(e,n=300){let a;return function(...r){clearTimeout(a),a=setTimeout(()=>{e.apply(this,r)},n)}}class g{}class B{constructor(){this.name="inputElement"}validate(n,...a){let r=n;return r==null?new Promise((o,s)=>{o({isValid:!0,errorMessage:""})}):new Promise((o,s)=>{r.checkValidity()?o({isValid:!0,errorMessage:r.validationMessage}):o({isValid:!1,errorMessage:r.validationMessage})})}}class F{constructor(){this.name="selectElement"}validate(n,...a){let r=n;return r==null?new Promise((o,s)=>{o({isValid:!0,errorMessage:""})}):new Promise((o,s)=>{r.checkValidity()?o({isValid:!0,errorMessage:r.validationMessage}):o({isValid:!1,errorMessage:r.validationMessage})})}}class C{constructor(){this.name="textAreaElement"}validate(n,...a){let r=n;return r==null?new Promise((o,s)=>{o({isValid:!0,errorMessage:""})}):new Promise((o,s)=>{r.checkValidity()?o({isValid:!0,errorMessage:r.validationMessage}):o({isValid:!1,errorMessage:r.validationMessage})})}}class le{constructor(){}static initialize(){this.rules??(this.rules=window.ValidationConfiguration||{}),window.ValidationConfiguration=this.rules}static addRuleGroup(n,a){this.initialize(),this.rules[n]=a}static async validate(n,a,r={}){this.initialize();let o=!0,s=this.rules[a];if(!s)return o;for(let i in s){if(!s.hasOwnProperty(i))continue;let l=n[i],d=s[i];for(let m=0;m<d.length;m++){let E=await d[m].validate(l);E.isValid||(o=!1,r.hasOwnProperty(i)?r[i].push(E.errorMessage):r[i]=[E.errorMessage])}}return o}static async validateForm(n,a=null,r={}){this.initialize(),a??(a=n.getAttribute("data-validation-rule-group")),a||(a=this.deriveObjectType(n));let o=this.rules[a];o||(o=this.extractRulesFromForm(n),this.addRuleGroup(a,o));const s=this.extractFormData(n);return this.validate(s,a,r)}static extractFormData(n){let a={},r=n.getElementsByTagName("input"),o=n.getElementsByTagName("textarea"),s=n.getElementsByTagName("select");for(let i=0;i<r.length;i++)a[r[i].name]=r[i];for(let i=0;i<o.length;i++)a[o[i].name]=o[i];for(let i=0;i<s.length;i++)a[s[i].name]=s[i];return a}static deriveObjectType(n){return n.action||n.id||n.name}static extractRulesFromForm(n){var i,l,d;let a={},r=n.getElementsByTagName("input"),o=n.getElementsByTagName("textarea"),s=n.getElementsByTagName("select");for(let m=0;m<r.length;++m){let u=r[m];u.willValidate&&(a[i=u.name]??(a[i]=[]),a[u.name].push(new B))}for(let m=0;m<o.length;++m){let u=o[m];u.willValidate&&(a[l=u.name]??(a[l]=[]),a[u.name].push(new C))}for(let m=0;m<s.length;++m){let u=s[m];u.willValidate&&(a[d=u.name]??(a[d]=[]),a[u.name].push(new F))}return a}}const de=t.defineComponent({name:"form-field-input",data:function(){return{internalModel:this.formatValue(this.model),internalSchema:this.schema,dataListQuery:"query($queryType: String!, $queryFilter: String!) { dropDown(type: $queryType, filter: $queryFilter) { key, value } }",errorMessage:""}},props:{model:{type:String,required:!0,default:""},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},methods:{willValidate:function(){return this.internalSchema.metadata.required||this.internalSchema.metadata.maxlength||this.internalSchema.metadata.minlength||this.internalSchema.metadata.pattern||this.internalSchema.metadata.min||this.internalSchema.metadata.max},revalidate:async function(){let e=document.getElementById(this.getFieldID());if(e==null)return;let n=await new B().validate(e);return this.errorMessage=n.errorMessage,n.isValid},convertToDate:function(e){return this.schema.metadata.isUTC?f.utc(e||new Date).local():f(e||new Date)},formatValue:function(e){return e&&(this.schema.metadata.inputType==="date"?this.convertToDate(e).format("YYYY-MM-DD"):this.schema.metadata.inputType==="datetime-local"||this.schema.metadata.inputType==="datetime"?this.convertToDate(e).format("YYYY-MM-DDTHH:mm"):this.schema.metadata.inputType==="month"?this.convertToDate(e).format("YYYY-MM"):e)},getFieldID:function(){return this.internalSchema.propertyName.slugify()+this.internalSchema.key},changed:function(e){this.updateDataList(),this.revalidate(),this.$emit("changed",e,this.schema)},getList:function(){return this.schema.metadata.datalist?this.getFieldID()+"-list":null},updateDataList:N(async function(){if(!this.internalSchema.metadata.queryType)return;let e=this;p.post("/api/query",{query:e.dataListQuery,variables:{queryType:e.internalSchema.metadata.queryType,queryFilter:e.internalModel}}).onSuccess(n=>{c.debug("Select: "+e.internalSchema.metadata.queryType+" loaded successfully.",n.data.dropDown),e.internalSchema.metadata.datalist=n.data.dropDown}).onError(n=>{c.error("Select: "+e.internalSchema.metadata.queryType+" failed to load.",n)}).withStorageMode(b.StorageAndUpdate).send()},300)},created:function(){this.updateDataList()},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),h=(e,n)=>{const a=e.__vccOpts||e;for(const[r,o]of n)a[r]=o;return a},ce=["for"],me={key:0,class:"error clear-background"},he={key:1,class:"clear-background active no-border small"},pe=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),fe={key:2,class:"error clear-background"},ue={key:3,class:"success clear-background fas fa-check-circle"},ge={key:1},ye=["id","type","disabled","accept","alt","autocomplete","checked","dirname","formaction","formenctype","formmethod","formnovalidate","formtarget","height","list","max","maxlength","min","minlength","multiple","name","pattern","placeholder","title","readonly","required","size","src","step","width","files","data-error-message-value-missing","data-error-message-pattern-mismatch","data-error-message-range-overflow","data-error-message-range-underflow","data-error-message-step-mismatch","data-error-message-too-long","data-error-message-too-short","data-error-message-bad-input","data-error-message-type-mismatch"],ke={key:2,class:"text-center"},Se=["id"],Ee=["value"];function ve(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.showLabel&&e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("label",{key:0,for:e.getFieldID()},[t.createTextVNode(t.toDisplayString(e.internalSchema.displayName)+" ",1),e.internalSchema.metadata.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",me,"*")):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.hint?(t.openBlock(),t.createElementBlock("i",he,[pe,t.createTextVNode(t.toDisplayString(e.internalSchema.metadata.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",fe,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",ue)):t.createCommentVNode("v-if",!0)],8,ce)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",ge,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.withDirectives(t.createElementVNode("input",{id:e.getFieldID(),type:e.internalSchema.metadata.inputType,"onUpdate:modelValue":n[0]||(n[0]=i=>e.internalModel=i),onInput:n[1]||(n[1]=i=>e.changed(i.target.value)),disabled:e.internalSchema.metadata.disabled,accept:e.internalSchema.metadata.accept,alt:e.internalSchema.metadata.alt,autocomplete:e.internalSchema.metadata.autocomplete,checked:e.internalSchema.metadata.checked,dirname:e.internalSchema.metadata.dirname,formaction:e.internalSchema.metadata.formaction,formenctype:e.internalSchema.metadata.formenctype,formmethod:e.internalSchema.metadata.formmethod,formnovalidate:e.internalSchema.metadata.formnovalidate,formtarget:e.internalSchema.metadata.formtarget,height:e.internalSchema.metadata.height,list:e.getList(),max:e.internalSchema.metadata.max,maxlength:e.internalSchema.metadata.maxlength,min:e.internalSchema.metadata.min,minlength:e.internalSchema.metadata.minlength,multiple:e.internalSchema.metadata.multiple,name:e.getFieldID(),pattern:e.internalSchema.metadata.pattern,placeholder:e.internalSchema.metadata.placeholder,title:e.internalSchema.metadata.placeholder,readonly:e.internalSchema.metadata.readonly,required:e.internalSchema.metadata.required,size:e.internalSchema.metadata.size,src:e.internalSchema.metadata.src,step:e.internalSchema.metadata.step,width:e.internalSchema.metadata.width,files:e.internalSchema.metadata.files,"data-error-message-value-missing":e.internalSchema.metadata.errorMessageValueMissing,"data-error-message-pattern-mismatch":e.internalSchema.metadata.errorMessagePatternMismatch,"data-error-message-range-overflow":e.internalSchema.metadata.errorMessageRangeOverflow,"data-error-message-range-underflow":e.internalSchema.metadata.errorMessageRangeUnderflow,"data-error-message-step-mismatch":e.internalSchema.metadata.errorMessageStepMismatch,"data-error-message-too-long":e.internalSchema.metadata.errorMessageTooLong,"data-error-message-too-short":e.internalSchema.metadata.errorMessageTooShort,"data-error-message-bad-input":e.internalSchema.metadata.errorMessageBadInput,"data-error-message-type-mismatch":e.internalSchema.metadata.errorMessageTypeMismatch},null,40,ye),[[t.vModelDynamic,e.internalModel]]),e.internalSchema.metadata.inputType==="color"||e.internalSchema.metadata.inputType==="range"?(t.openBlock(),t.createElementBlock("div",ke,t.toDisplayString(e.internalModel),1)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.datalist?(t.openBlock(),t.createElementBlock("datalist",{key:3,id:e.getList()},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema.metadata.datalist,i=>(t.openBlock(),t.createElementBlock("option",{value:i.value,key:i.key},null,8,Ee))),128))],8,Se)):t.createCommentVNode("v-if",!0)])}const R=h(de,[["render",ve]]);class I{static get domain(){return window.location.protocol+"//"+window.location.host+"/"}static get isLocal(){return/^http:\/\/localhost:\d{5}\/$/.test(I.domain)}static get HashBang(){return window.location.hash.replace("#!","")}static get Id(){return window.location.pathname.substring(window.location.pathname.lastIndexOf("/")+1)}static GetQueryString(n){let a=window.location.href;var r=new RegExp("[?&]"+n+"=([^&#]*)","i"),o=r.exec(a);return o?o[1]:null}static setPageTitle(n){document.title=n}}const be=t.defineComponent({name:"form-field-markdown",data:function(){return{internalModel:this.model,internalSchema:this.schema,errorMessage:""}},props:{model:{type:String,required:!0,default:""},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},computed:{compiledMarkdown:function(){return this.markdown(this.currentContent)}},methods:{willValidate:function(){return this.internalSchema.metadata.required||this.internalSchema.metadata.maxlength||this.internalSchema.metadata.minlength||this.internalSchema.metadata.pattern||this.internalSchema.metadata.min||this.internalSchema.metadata.max},revalidate:async function(){let e=document.getElementById(this.getFieldID());if(e==null)return;let n=await new C().validate(e);return this.errorMessage=n.errorMessage,n.isValid},getFieldID:function(){return this.internalSchema.propertyName.slugify()+this.internalSchema.key},showFrame:function(e){this.displayFrame=!0,e==="image"?this.iframeSrc=this.iframeImageSrc:this.iframeSrc=this.iframeFileSrc},markdown:function(e){if(!e)return e;var n=new v.Converter({tables:!0,strikethrough:!0,emoji:!0,underline:!0,ghMentions:!0,ghMentionsLink:I.domain+"People/{u}"});return n.makeHtml(e)},keyup:function(){this.$emit("keyup",{content:this.currentContent})},cancel:function(){this.$emit("cancel")},tag:function(e){let n=document.getElementById("editorInput");if(!n)return;let a=n.selectionStart,r=n.selectionEnd,o=e+this.currentContent.substring(a,r);this.currentContent=this.currentContent.substring(0,a)+o+this.currentContent.substring(r,this.currentContent.length),n.focus()},symmetricTag:function(e){let n=document.getElementById("editorInput");if(!n)return;let a=n.selectionStart,r=n.selectionEnd,o=e+this.currentContent.substring(a,r)+e;this.currentContent=this.currentContent.substring(0,a)+o+this.currentContent.substring(r,this.currentContent.length),n.focus()},linkTag:function(e){let n=document.getElementById("editorInput");if(!n)return;let a=n.selectionStart,r=n.selectionEnd,o="["+this.currentContent.substring(a,r)+"]("+e+")";this.currentContent=this.currentContent.substring(0,a)+o+this.currentContent.substring(r,this.currentContent.length),n.focus()},imageTag:function(e){let n=document.getElementById("editorInput");if(!n)return;let a=n.selectionStart,r=n.selectionEnd,o="!["+this.currentContent.substring(a,r)+"]("+e+")";this.currentContent=this.currentContent.substring(0,a)+o+this.currentContent.substring(r,this.currentContent.length),n.focus()}},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){let e=this;window.addEventListener("message",function(n){if(typeof n.data!="string")return;let a=JSON.parse(n.data);e.displayFrame=!1,a.href&&(e.iframeSrc==e.iframeImageSrc?e.imageTag(a.href):e.linkTag(a.href))}),this.$nextTick(function(){this.revalidate()})}}),w=e=>(t.pushScopeId("data-v-86512c36"),e=e(),t.popScopeId(),e),$e={class:"flex row"},we={class:"flex-item flex justify-space-between column wrap",id:"editorRawInput"},Ne={class:"menu pill flex-item"},Be={class:"item has-children"},Ce=w(()=>t.createElementVNode("a",{href:"#!"},"Header",-1)),Me={class:"item has-children"},De=w(()=>t.createElementVNode("a",{href:"#!"},"Format",-1)),Te={class:"item has-children"},Fe=w(()=>t.createElementVNode("a",{href:"#!"},"List",-1)),Ie={class:"item has-children"},qe=w(()=>t.createElementVNode("a",{href:"#!"},"File",-1)),je=w(()=>t.createElementVNode("br",null,null,-1)),Le={key:0,class:"flex-item",id:"editorCompiledInput"},Ae=["innerHTML"],Oe={key:1,class:"iframe-holder z-depth-2"},Pe=["src"];function ze(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",$e,[t.createElementVNode("div",we,[t.createElementVNode("nav",Ne,[t.createElementVNode("ul",null,[t.createElementVNode("li",Be,[Ce,t.createElementVNode("ul",null,[t.createElementVNode("li",null,[t.createElementVNode("h1",null,[t.createElementVNode("a",{href:"#!",onClick:n[0]||(n[0]=t.withModifiers(i=>e.tag("#"),["stop","prevent"]))},"Header 1")])]),t.createElementVNode("li",null,[t.createElementVNode("h2",null,[t.createElementVNode("a",{href:"#!",onClick:n[1]||(n[1]=t.withModifiers(i=>e.tag("##"),["stop","prevent"]))},"Header 2")])]),t.createElementVNode("li",null,[t.createElementVNode("h3",null,[t.createElementVNode("a",{href:"#!",onClick:n[2]||(n[2]=t.withModifiers(i=>e.tag("###"),["stop","prevent"]))},"Header 3")])]),t.createElementVNode("li",null,[t.createElementVNode("h4",null,[t.createElementVNode("a",{href:"#!",onClick:n[3]||(n[3]=t.withModifiers(i=>e.tag("####"),["stop","prevent"]))},"Header 4")])]),t.createElementVNode("li",null,[t.createElementVNode("h5",null,[t.createElementVNode("a",{href:"#!",onClick:n[4]||(n[4]=t.withModifiers(i=>e.tag("#####"),["stop","prevent"]))},"Header 5")])]),t.createElementVNode("li",null,[t.createElementVNode("h6",null,[t.createElementVNode("a",{href:"#!",onClick:n[5]||(n[5]=t.withModifiers(i=>e.tag("######"),["stop","prevent"]))},"Header 6")])])])]),t.createElementVNode("li",Me,[De,t.createElementVNode("ul",null,[t.createElementVNode("li",null,[t.createElementVNode("strong",null,[t.createElementVNode("a",{href:"#!",onClick:n[6]||(n[6]=t.withModifiers(i=>e.symmetricTag("**"),["stop","prevent"]))},"Bold")])]),t.createElementVNode("li",null,[t.createElementVNode("em",null,[t.createElementVNode("a",{href:"#!",onClick:n[7]||(n[7]=t.withModifiers(i=>e.symmetricTag("*"),["stop","prevent"]))},"Italics")])]),t.createElementVNode("li",null,[t.createElementVNode("del",null,[t.createElementVNode("a",{href:"#!",onClick:n[8]||(n[8]=t.withModifiers(i=>e.symmetricTag("~~"),["stop","prevent"]))},"Strikethrough")])]),t.createElementVNode("li",null,[t.createElementVNode("u",null,[t.createElementVNode("a",{href:"#!",onClick:n[9]||(n[9]=t.withModifiers(i=>e.symmetricTag("__"),["stop","prevent"]))},"Underline")])]),t.createElementVNode("li",null,[t.createElementVNode("a",{href:"#!",onClick:n[10]||(n[10]=t.withModifiers(i=>e.tag(">"),["stop","prevent"]))},"Quote")])])]),t.createElementVNode("li",null,[t.createElementVNode("a",{href:"#!",onClick:n[11]||(n[11]=t.withModifiers(i=>e.tag(`

-------

`),["stop","prevent"]))},"HR")]),t.createElementVNode("li",Te,[Fe,t.createElementVNode("ul",null,[t.createElementVNode("li",null,[t.createElementVNode("a",{href:"#!",onClick:n[12]||(n[12]=t.withModifiers(i=>e.tag("1. "),["stop","prevent"])),class:"fa-list-ol"},"Ordered")]),t.createElementVNode("li",null,[t.createElementVNode("a",{href:"#!",onClick:n[13]||(n[13]=t.withModifiers(i=>e.tag("* "),["stop","prevent"])),class:"fa-list-ul"},"Unordered")])])]),t.createElementVNode("li",Ie,[qe,t.createElementVNode("ul",null,[t.createElementVNode("li",null,[t.createElementVNode("a",{href:"#!",onClick:n[14]||(n[14]=t.withModifiers(i=>e.showFrame("image"),["stop","prevent"])),class:"fa-image"})]),t.createElementVNode("li",null,[t.createElementVNode("a",{href:"#!",onClick:n[15]||(n[15]=t.withModifiers(i=>e.showFrame("file"),["stop","prevent"])),class:"fa-link"})])])])])]),t.withDirectives(t.createElementVNode("textarea",{"onUpdate:modelValue":n[16]||(n[16]=i=>e.internalModel=i),id:"editorInput",name:"editorInput",class:"flex-item",onKeyup:n[17]||(n[17]=(...i)=>e.keyup&&e.keyup(...i))},null,544),[[t.vModelText,e.internalModel]]),je]),e.displayPreview?(t.openBlock(),t.createElementBlock("div",Le,[t.createElementVNode("h1",null,t.toDisplayString(e.currentTitle),1),t.createElementVNode("div",{innerHTML:e.compiledMarkdown},null,8,Ae)])):t.createCommentVNode("v-if",!0),e.displayFrame?(t.openBlock(),t.createElementBlock("div",Oe,[t.createElementVNode("iframe",{src:e.iframeSrc},null,8,Pe)])):t.createCommentVNode("v-if",!0)])}const U=h(be,[["render",ze],["__scopeId","data-v-86512c36"]]),Re=t.defineComponent({name:"form-field-html",data:function(){return{internalModel:this.model,internalSchema:this.schema,errorMessage:"",currentCallback:null}},props:{model:{type:String,required:!0,default:""},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},computed:{compiledMarkdown:function(){return this.markdown(this.currentContent)}},methods:{willValidate:function(){return this.internalSchema.metadata.required||this.internalSchema.metadata.maxlength||this.internalSchema.metadata.minlength||this.internalSchema.metadata.pattern||this.internalSchema.metadata.min||this.internalSchema.metadata.max},revalidate:async function(){let e=document.getElementById(this.getFieldID());if(e==null)return;let n=await new C().validate(e);return this.errorMessage=n.errorMessage,n.isValid},getFieldID:function(){return this.internalSchema.propertyName.slugify()+this.internalSchema.key},imageFilePicker:function(e,n,a){this.currentCallback=e,tinymce.activeEditor.windowManager.open({body:{type:"panel",items:[{type:"htmlpanel",html:'<iframe id="media-browser" src="/services/filebrowser/'+a.filetype+'" style="width: 100%; height: 565px; border: 0;"></iframe>',flex:1}]},title:a.filetype.charAt(0).toUpperCase()+a.filetype.substr(1).toLowerCase()+" Picker",size:"large"})},processEditOperation:function(e){this.text=tinymce.get(this.getFieldID()).getContent(),this.changed(this.text)},changed:function(e){this.revalidate(),this.$emit("changed",e,this.schema)}},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},unmounted:function(){tinymce.remove()},mounted:function(){let e=this;window.addEventListener("message",function(a){if(typeof a.data!="string"||!e.currentCallback)return;let r=JSON.parse(a.data);r.href&&e.currentCallback(r.href,{title:r.href}),e.currentCallback=null,tinymce.activeEditor.windowManager.close()});let n=this.getFieldID();tinymce.init({selector:"#"+n,height:"500px",skin:"oxide-dark",plugins:["advlist","autolink","link","image","lists","charmap","preview","anchor","pagebreak","searchreplace","wordcount","visualblocks","visualchars","code","fullscreen","insertdatetime","media","table","emoticons","template"],menu:{file:{title:"File",items:"newdocument restoredraft | preview | export print | deleteallconversations"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | styles blocks fontfamily fontsize align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"},table:{title:"Table",items:"inserttable | cell row column | advtablesort | tableprops deletetable"}},textpattern_patterns:[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],relative_urls:!1,a11y_advanced_options:!0,file_picker_callback:function(a,r,o){e.imageFilePicker(a,r,o)},setup:function(a){c.debug("TinyMCE setup"),a.on("change",function(r){e.innerModel=a.getContent(),e.changed(e.innerModel)}),a.on("KeyUp",function(r){e.innerModel=a.getContent(),e.changed(e.innerModel)})}})}}),Ue=e=>(t.pushScopeId("data-v-3159fbc5"),e=e(),t.popScopeId(),e),Ye=["for"],He={key:0,class:"error clear-background"},Ke={key:1,class:"clear-background active no-border small"},Ge=Ue(()=>t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1)),Qe={key:2,class:"error clear-background"},Je={key:3,class:"success clear-background fas fa-check-circle"},We={key:1},Ze={class:"editor"},Xe=["id","disabled","height","maxlength","minlength","name","placeholder","title","readonly","required","width","rows","data-error-message-value-missing","data-error-message-too-long","data-error-message-too-short"];function _e(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.showLabel&&e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("label",{key:0,for:e.getFieldID()},[t.createTextVNode(t.toDisplayString(e.internalSchema.displayName)+" ",1),e.internalSchema.metadata.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",He,"*")):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.hint?(t.openBlock(),t.createElementBlock("i",Ke,[Ge,t.createTextVNode(t.toDisplayString(e.internalSchema.metadata.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",Qe,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",Je)):t.createCommentVNode("v-if",!0)],8,Ye)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",We,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.createElementVNode("div",Ze,[t.withDirectives(t.createElementVNode("textarea",{id:e.getFieldID(),"onUpdate:modelValue":n[0]||(n[0]=i=>e.internalModel=i),disabled:e.internalSchema.metadata.disabled,height:e.internalSchema.metadata.height,maxlength:e.internalSchema.metadata.maxlength,minlength:e.internalSchema.metadata.minlength,name:e.getFieldID(),placeholder:e.internalSchema.metadata.placeholder,title:e.internalSchema.metadata.placeholder,readonly:e.internalSchema.metadata.readonly,class:t.normalizeClass(e.internalSchema.inputClasses),required:e.internalSchema.metadata.required,width:e.internalSchema.metadata.width,rows:e.internalSchema.metadata.rows||3,"data-error-message-value-missing":e.internalSchema.metadata.errorMessageValueMissing,"data-error-message-too-long":e.internalSchema.metadata.errorMessageTooLong,"data-error-message-too-short":e.internalSchema.metadata.errorMessageTooShort},`\r
            `,10,Xe),[[t.vModelText,e.internalModel]])])])}const Y=h(Re,[["render",_e],["__scopeId","data-v-3159fbc5"]]),xe=t.defineComponent({name:"form-field-select",data:function(){return{internalModel:this.model,internalSchema:this.schema,optionsQuery:"query($queryType: String!) { dropDown(type: $queryType) { key, value } }",errorMessage:""}},props:{model:{type:String,required:!0,default:""},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},methods:{willValidate:function(){return this.internalSchema.metadata.required},revalidate:async function(){let e=await new F().validate(document.getElementById(this.getFieldID()));return this.errorMessage=e.errorMessage,e.isValid},getFieldID:function(){return this.internalSchema.propertyName.slugify()+this.internalSchema.key},changed:function(e){this.revalidate(),this.$emit("changed",e,this.schema)},isSelected:function(e){return this.internalModel===e.key},getValues:async function(){if(!this.internalSchema.metadata.queryType)return;let e=this;c.debug("Select: Getting values for "+this.internalSchema.metadata.queryType),await p.post("/api/query",{query:e.optionsQuery,variables:{queryType:e.internalSchema.metadata.queryType}}).onSuccess(n=>{c.debug("Select: "+e.internalSchema.metadata.queryType+" loaded successfully.",n.data.dropDown),e.internalSchema.metadata.options=n.data.dropDown}).onError(n=>{c.error("Select: "+e.internalSchema.metadata.queryType+" failed to load.",n)}).withStorageMode(b.StorageAndUpdate).send()}},created:function(){this.getValues()},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),Ve=["for"],et={key:0,class:"error clear-background"},tt={key:1,class:"clear-background active no-border small"},nt=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),at={key:2,class:"error clear-background"},rt={key:3,class:"success clear-background fas fa-check-circle"},it={key:1},ot=["disabled","name","height","id","readonly","required","multiple","width","data-error-message-value-missing"],st=["value","selected"];function lt(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.showLabel&&e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("label",{key:0,for:e.getFieldID()},[t.createTextVNode(t.toDisplayString(e.internalSchema.displayName)+" ",1),e.internalSchema.metadata.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",et,"*")):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.hint?(t.openBlock(),t.createElementBlock("i",tt,[nt,t.createTextVNode(t.toDisplayString(e.internalSchema.metadata.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",at,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",rt)):t.createCommentVNode("v-if",!0)],8,Ve)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",it,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.withDirectives(t.createElementVNode("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>e.internalModel=i),disabled:e.internalSchema.metadata.disabled,name:e.internalSchema.metadata.inputName||e.getFieldID(),height:e.internalSchema.metadata.height,id:e.getFieldID(),onChange:n[1]||(n[1]=i=>e.changed(e.internalModel)),readonly:e.internalSchema.metadata.readonly,required:e.internalSchema.metadata.required,multiple:e.internalSchema.metadata.multiple,class:t.normalizeClass(e.internalSchema.metadata.inputClasses),width:e.internalSchema.metadata.width,"data-error-message-value-missing":e.internalSchema.metadata.errorMessageValueMissing},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema.metadata.options,i=>(t.openBlock(),t.createElementBlock("option",{value:i.key,selected:e.isSelected(i),key:i.key},t.toDisplayString(i.value),9,st))),128))],42,ot),[[t.vModelSelect,e.internalModel]])])}const H=h(xe,[["render",lt]]),dt=t.defineComponent({name:"form-field-checkbox",data:function(){return{internalModel:this.model,internalSchema:this.schema,errorMessage:""}},props:{model:{type:Boolean,required:!0,default:!1},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},methods:{willValidate:function(){return this.internalSchema.metadata.required},revalidate:async function(){let e=document.getElementById(this.getFieldID());if(e==null)return;let n=await new B().validate(e);return this.errorMessage=n.errorMessage,n.isValid},getFieldID:function(){return this.internalSchema.propertyName.slugify()+this.internalSchema.key},changed:function(e){this.revalidate(),this.$emit("changed",e,this.schema)}},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),ct=["for"],mt={key:0},ht={key:1,class:"error clear-background"},pt={key:2,class:"error clear-background"},ft={key:3,class:"success clear-background fas fa-check-circle"},ut={key:4},gt=["id","checked","disabled","dirname","name","readonly","required"];function yt(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createElementVNode("label",{for:e.getFieldID()},[e.showLabel&&e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("span",mt,t.toDisplayString(e.internalSchema.displayName),1)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",ht,"*")):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",pt,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",ft)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",ut,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.createElementVNode("input",{id:e.getFieldID(),type:"checkbox",checked:e.internalModel,onClick:n[0]||(n[0]=i=>e.changed(i.target.checked)),disabled:e.internalSchema.metadata.disabled,dirname:e.internalSchema.metadata.dirname,name:e.getFieldID(),readonly:e.internalSchema.metadata.readonly,required:e.internalSchema.metadata.required},null,8,gt)],8,ct)])}const K=h(dt,[["render",yt]]),kt=t.defineComponent({name:"form-field-radio",data:function(){return{internalModel:this.model,internalSchema:this.schema,optionsQuery:"query($queryType: String!) { dropDown(type: $queryType) { key, value } }",errorMessage:""}},props:{model:{type:String,required:!0,default:""},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},methods:{willValidate:function(){return this.internalSchema.metadata.required},revalidate:async function(){let e=await new F().validate(document.getElementById(this.getFieldID()));return this.errorMessage=e.errorMessage,e.isValid},getFieldID:function(){if(this.internalSchema!=null)return this.internalSchema.propertyName.slugify()+this.internalSchema.key},getFieldName:function(){return this.internalSchema.id?this.internalSchema.id:this.internalSchema.propertyName.slugify()},changed:function(e){this.revalidate(),this.$emit("changed",e,this.schema)},isItemChecked:function(e){return e===this.internalModel},isSelected:function(e){return this.internalModel===e.key},getValues:async function(){if(!this.internalSchema.metadata.queryType)return;let e=this;c.debug("Select: Getting values for "+this.internalSchema.metadata.queryType),await p.post("/api/query",{query:e.optionsQuery,variables:{queryType:e.internalSchema.metadata.queryType}}).onSuccess(n=>{c.debug("Select: "+e.internalSchema.metadata.queryType+" loaded successfully.",n.data.dropDown),e.internalSchema.metadata.options=n.data.dropDown}).onError(n=>{c.error("Select: "+e.internalSchema.metadata.queryType+" failed to load.",n)}).withStorageMode(b.StorageAndUpdate).send()}},created:function(){this.getValues()},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),St=["for"],Et={key:0,class:"error clear-background"},vt={key:1,class:"clear-background active no-border small"},bt=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),$t={key:2,class:"error clear-background"},wt={key:3,class:"success clear-background fas fa-check-circle"},Nt={key:1},Bt={class:"flex row text-center"},Ct=["id","checked","onClick","disabled","name","readonly","value"];function Mt(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.showLabel&&e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("label",{key:0,for:e.getFieldID()},[t.createTextVNode(t.toDisplayString(e.internalSchema.displayName)+" ",1),e.internalSchema.metadata.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",Et,"*")):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.hint?(t.openBlock(),t.createElementBlock("i",vt,[bt,t.createTextVNode(t.toDisplayString(e.internalSchema.metadata.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",$t,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",wt)):t.createCommentVNode("v-if",!0)],8,St)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",Nt,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.createElementVNode("div",Bt,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema.metadata.options,i=>(t.openBlock(),t.createElementBlock("div",{key:i.key},[t.createElementVNode("label",null,[t.createElementVNode("input",{id:e.getFieldID(i.key),type:"radio",checked:e.isItemChecked(i.key),onClick:l=>e.changed(i.key),disabled:e.internalSchema.metadata.disabled,name:e.internalSchema.metadata.inputName||e.getFieldName(),readonly:e.internalSchema.metadata.readonly,class:t.normalizeClass(e.internalSchema.metadata.inputClasses),value:i.key},null,10,Ct),t.createTextVNode(" "+t.toDisplayString(e.$filters.capitalize(i.value)),1)])]))),128))])])}const G=h(kt,[["render",Mt]]),Dt=t.defineComponent({name:"form-field-textarea",data:function(){return{internalModel:this.model,internalSchema:this.schema,errorMessage:""}},props:{model:{type:String,required:!0,default:""},schema:{type:g,required:!0,default:()=>new g},showLabel:{type:Boolean,required:!1,default:!0}},computed:{charactersRemaining:function(){return this.internalSchema.metadata.maxlength-this.internalModel.length}},methods:{willValidate:function(){return this.internalSchema.metadata.required||this.internalSchema.metadata.maxlength||this.internalSchema.metadata.minlength||this.internalSchema.metadata.pattern||this.internalSchema.metadata.min||this.internalSchema.metadata.max},revalidate:async function(){let e=document.getElementById(this.getFieldID());if(e==null)return;let n=await new C().validate(e);return this.errorMessage=n.errorMessage,n.isValid},getFieldID:function(){return this.internalSchema.propertyName.slugify()+this.internalSchema.key},changed:function(e){this.revalidate(),this.$emit("changed",e,this.schema)}},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))},schema:function(e,n){n!==e&&(this.internalSchema=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),Tt=["for"],Ft={key:0,class:"error clear-background"},It={key:1,class:"clear-background active no-border small"},qt=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),jt={key:2,class:"error clear-background"},Lt={key:3,class:"success clear-background fas fa-check-circle"},At={key:1},Ot=["id","height","maxlength","minlength","name","placeholder","title","readonly","required","width","rows","disabled","data-error-message-value-missing","data-error-message-pattern-mismatch","data-error-message-range-overflow","data-error-message-range-underflow","data-error-message-step-mismatch","data-error-message-too-long","data-error-message-too-short","data-error-message-bad-input","data-error-message-type-mismatch"],Pt={key:2,class:"clear-background active right small"},zt=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),Rt=t.createElementVNode("br",{class:"clear"},null,-1);function Ut(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.showLabel&&e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("label",{key:0,for:e.getFieldID()},[t.createTextVNode(t.toDisplayString(e.internalSchema.displayName)+" ",1),e.internalSchema.metadata.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",Ft,"*")):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.hint?(t.openBlock(),t.createElementBlock("i",It,[qt,t.createTextVNode(t.toDisplayString(e.internalSchema.metadata.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",jt,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",Lt)):t.createCommentVNode("v-if",!0)],8,Tt)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",At,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.withDirectives(t.createElementVNode("textarea",{id:e.getFieldID(),"onUpdate:modelValue":n[0]||(n[0]=i=>e.internalModel=i),onInput:n[1]||(n[1]=i=>e.changed(i.target.value)),height:e.internalSchema.metadata.height,maxlength:e.internalSchema.metadata.maxlength,minlength:e.internalSchema.metadata.minlength,name:e.getFieldID(),placeholder:e.internalSchema.metadata.placeholder,title:e.internalSchema.metadata.placeholder,readonly:e.internalSchema.metadata.readonly,required:e.internalSchema.metadata.required,width:e.internalSchema.metadata.width,rows:e.internalSchema.metadata.rows||3,disabled:e.internalSchema.metadata.disabled,"data-error-message-value-missing":e.internalSchema.metadata.errorMessageValueMissing,"data-error-message-pattern-mismatch":e.internalSchema.metadata.errorMessagePatternMismatch,"data-error-message-range-overflow":e.internalSchema.metadata.errorMessageRangeOverflow,"data-error-message-range-underflow":e.internalSchema.metadata.errorMessageRangeUnderflow,"data-error-message-step-mismatch":e.internalSchema.metadata.errorMessageStepMismatch,"data-error-message-too-long":e.internalSchema.metadata.errorMessageTooLong,"data-error-message-too-short":e.internalSchema.metadata.errorMessageTooShort,"data-error-message-bad-input":e.internalSchema.metadata.errorMessageBadInput,"data-error-message-type-mismatch":e.internalSchema.metadata.errorMessageTypeMismatch},`\r
        `,40,Ot),[[t.vModelText,e.internalModel]]),e.internalSchema.metadata.maxlength?(t.openBlock(),t.createElementBlock("div",Pt,[zt,t.createTextVNode(" "+t.toDisplayString(e.charactersRemaining)+" characters remaining ("+t.toDisplayString(e.internalSchema.metadata.maxlength)+" max) ",1)])):t.createCommentVNode("v-if",!0),Rt])}const Q=h(Dt,[["render",Ut]]),Yt=t.defineComponent({data:function(){return{internalModel:this.model}},props:{model:Object,schema:Object,idSuffix:String},methods:{},watch:{model:function(e,n){n!==e&&(this.internalModel=e)}}}),Ht=["innerHTML"];function Kt(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createTextVNode(" Text "),t.createElementVNode("div",{class:t.normalizeClass(e.schema.classes),innerHTML:e.internalModel||e.schema.model},null,10,Ht)])}const J=h(Yt,[["render",Kt]]),Gt=t.defineComponent({data(){return{files:[],ready:!1,filesAdded:0,internalModel:this.model,errorMessage:""}},props:{model:Object,schema:Object,idSuffix:String},methods:{willValidate:function(){return this.internalSchema.metadata.required||this.internalSchema.metadata.maxlength||this.internalSchema.metadata.minlength||this.internalSchema.metadata.pattern||this.internalSchema.metadata.min||this.internalSchema.metadata.max},revalidate:async function(){let e=await new B().validate(document.getElementById(this.getFieldID()));return this.errorMessage=e.errorMessage,e.isValid},getFieldID:function(){let e="";return this.schema.id?e=this.schema.id:e=this.schema.model.slugify(),this.idSuffix!==void 0&&(e+=this.idSuffix),e},changed:function(e){this.revalidate();let n=this;n.filesAdded=n.filesAdded+e.target.files.length,n.ready=!1;for(let a=0;a<e.target.files.length;++a){let r=new FileReader;r.onload=function(o){return function(s){n.files=n.files.concat({filename:o,data:n.base64ArrayBuffer(r.result)}),n.files.length===n.filesAdded&&(n.ready=!0)}}(e.target.files[a].name),r.readAsArrayBuffer(e.target.files[a])}this.check()},base64ArrayBuffer:function(e){let n="",a=new Uint8Array(e),r=a.byteLength;for(let o=0;o<r;++o)n+=String.fromCharCode(a[o]);return window.btoa(n)},check:function(){if(this.ready===!0){this.$emit("changed",this.files,this.schema);return}setTimeout(this.check,100)},removeFile:function(e){let n=this.files.indexOf(e);this.files.splice(n,1),this.filesAdded--},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e,this.$nextTick(function(){this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),Qt=["for"],Jt={key:0,class:"error clear-background"},Wt={key:1,class:"clear-background active no-border small"},Zt=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),Xt={key:2,class:"error clear-background"},_t={key:3,class:"success clear-background fas fa-check-circle"},xt=["for"],Vt={key:0,class:"error clear-background"},en={key:1,class:"clear-background active no-border small"},tn=t.createElementVNode("span",{class:"fas fa-info-circle"},null,-1),nn={key:2,class:"error clear-background"},an={key:3,class:"success clear-background fas fa-check-circle"},rn={key:2},on=["accept","id","multiple","name","required","data-error-message-value-missing"],sn={key:3,class:"flex"},ln=["onClick"],dn={class:"body"};function cn(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createTextVNode(" Upload "),e.schema.label?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createElementBlock("label",{key:0,for:e.getFieldID(),class:t.normalizeClass(e.schema.labelClasses)},[t.createTextVNode(t.toDisplayString(e.$filters.capitalize(e.schema.model))+" ",1),e.schema.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",Jt,"*")):t.createCommentVNode("v-if",!0),e.schema.hint?(t.openBlock(),t.createElementBlock("i",Wt,[Zt,t.createTextVNode(t.toDisplayString(e.schema.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",Xt,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",_t)):t.createCommentVNode("v-if",!0)],10,Qt)),e.schema.label?(t.openBlock(),t.createElementBlock("label",{key:1,for:e.getFieldID(),class:t.normalizeClass(e.schema.labelClasses)},[t.createTextVNode(t.toDisplayString(e.schema.label)+" ",1),e.schema.required&&e.errorMessage?(t.openBlock(),t.createElementBlock("span",Vt,"*")):t.createCommentVNode("v-if",!0),e.schema.hint?(t.openBlock(),t.createElementBlock("i",en,[tn,t.createTextVNode(t.toDisplayString(e.schema.hint),1)])):t.createCommentVNode("v-if",!0),e.errorMessage?(t.openBlock(),t.createElementBlock("span",nn,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("v-if",!0),!e.errorMessage&&e.willValidate()?(t.openBlock(),t.createElementBlock("span",an)):t.createCommentVNode("v-if",!0)],10,xt)):t.createCommentVNode("v-if",!0),e.internalSchema.metadata.subtitle?(t.openBlock(),t.createElementBlock("div",rn,t.toDisplayString(e.internalSchema.metadata.subtitle),1)):t.createCommentVNode("v-if",!0),t.createElementVNode("div",{class:t.normalizeClass(["file-upload",e.schema.inputClasses])},[t.createTextVNode(t.toDisplayString(e.schema.placeholder)+" ",1),t.createElementVNode("input",{accept:e.schema.accept,id:e.getFieldID(),onChange:n[0]||(n[0]=i=>e.changed(i)),multiple:e.schema.multiple,name:e.schema.inputName||e.getFieldID(),required:e.schema.required,type:"file","data-error-message-value-missing":e.schema.errorMessageValueMissing},null,40,on)],2),e.schema.uploadPreview?(t.openBlock(),t.createElementBlock("div",sn,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.files,i=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["upload-preview panel",e.schema.previewClasses]),key:e.generateGuid(i)},[t.createElementVNode("header",null,[t.createElementVNode("div",{class:"header",onClick:l=>e.removeFile(i)},"×",8,ln),t.createTextVNode(" ")]),t.createElementVNode("div",dn,t.toDisplayString(i.filename),1)],2))),128))])):t.createCommentVNode("v-if",!0)])}const W=h(Gt,[["render",cn]]),mn=t.defineComponent({data:function(){return{internalModel:this.model}},props:{model:Object,schema:Object,idSuffix:String},methods:{click:function(e,n){return this.$emit("click",e,n),!1},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)}}}),hn={class:"controls"},pn={class:"input-group"},fn=["type","value","onClick"];function un(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",hn,[t.createTextVNode(" Buttons "),t.createElementVNode("div",pn,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.schema.buttons,i=>(t.openBlock(),t.createElementBlock("input",{key:e.generateGuid(i),type:i.type,value:i.value,class:t.normalizeClass(i.classes),onClick:l=>e.click(l,i)},null,10,fn))),128))])])}const Z=h(mn,[["render",un]]),gn=t.defineComponent({data:function(){return{internalModel:this.model}},props:{model:Object,schema:Object,idSuffix:String},methods:{show:function(e){return typeof e=="function"?e():e},getFieldType:function(e){return e.type.indexOf("form-field-")==0?e.type:"form-field-"+e.type},getModelValue:function(e){return this.internalModel[e.model]},error:function(e){this.$emit("error",e)},exception:function(e){this.$emit("exception",e)},setModelValue:function(e,n){this.internalModel[n.model]=e,this.$emit("changed",this.internalModel,this.schema)},buttonClicked:function(e,n){this.$emit("click",e,n)},getSchema:function(e){return e.type.startsWith("complex")?(e.schema.model===void 0&&(e.schema.model=e.model),e.schema):e},getIDSuffix:function(e){return this.idSuffix===void 0?"":this.idSuffix},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)}}}),yn={key:0};function kn(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createTextVNode(" Conditional "),e.show(e.internalModel.display||e.schema.display)?(t.openBlock(),t.createElementBlock("div",yn,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.schema.fields,i=>(t.openBlock(),t.createElementBlock("div",{key:e.generateGuid(i)},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(e.getFieldType(i)),{schema:e.getSchema(i),model:e.getModelValue(i),"id-suffix":e.getIDSuffix(i),onChanged:e.setModelValue,onClick:e.buttonClicked,onError:e.error,onException:e.exception},null,40,["schema","model","id-suffix","onChanged","onClick","onError","onException"]))]))),128))])):t.createCommentVNode("v-if",!0)])}const Sn=h(gn,[["render",kn]]),En=t.defineComponent({name:"form-field-complex-list",components:{"form-field-input":R,"form-field-select":H,"form-field-checkbox":K,"form-field-radio":G,"form-field-textarea":Q,"form-field-text":J,"form-field-upload":W,"form-field-buttons":Z,"form-field-markdown":U,"form-field-html":Y},data:function(){return{internalModel:this.model,internalSchema:this.schema,defaultItem:this.getDefaultValue(this.schema)}},props:{model:{type:Object,default:{}},schema:{type:Object,default:{fields:[]}}},methods:{getDefaultValue(e){if(e==null)return{};let n={};for(let a=0;a<e.metadata.fields.length;++a){let r=e.metadata.fields[a];if(r.propertyType.indexOf("complex")==-1)if(r.metadata.inputType==="date"||r.metadata.inputType==="datetime-local"||r.metadata.inputType==="datetime"||r.metadata.inputType==="month"){let o=moment(new Date);r.isUTC&&(o=moment.utc(new Date).local()),r.inputType==="date"?n[r.propertyName]=o.format("YYYY-MM-DD"):r.inputType==="datetime-local"||r.inputType==="datetime"?n[r.propertyName]=o.format("YYYY-MM-DDTHH:mm"):r.inputType==="month"&&(n[r.propertyName]=o.format("YYYY-MM"))}else n[r.propertyName]="";else r.propertyType.indexOf("complex-list")>-1||r.propertyType.indexOf("complex-repeater")>-1?n[r.propertyName]=[]:n[r.propertyName]=this.getDefaultValue(r)}return n},getFieldType:function(e){return"form-field-"+e.propertyType},getModelValue:function(e,n){return n[e.propertyName]},setModelValue:function(e,n,a){n[e.propertyName]=a,this.$emit("changed",this.internalModel,this.schema)},error:function(e){this.$emit("error",e)},exception:function(e){this.$emit("exception",e)},buttonClicked:function(e,n){this.$emit("click",e,n)},removeItem:function(e){if(this.internalSchema.confirmRemoval&&!confirm("Are you sure you want to remove this item?"))return;this.internalModel||(this.internalModel=[]);let n=this.internalModel.indexOf(e);this.internalModel.splice(n,1),this.$emit("changed",this.internalModel,this.internalSchema)},addItem:function(){this.internalModel||(this.internalModel=[]),this.internalModel=this.internalModel.concat(Object.assign({},this.defaultItem)),this.$emit("changed",this.internalModel,this.schema)},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)},schema:function(e,n){n!==e&&(this.internalSchema=e)}}}),vn={key:0},bn={class:"form-table"},$n=["data-tooltip"],wn=[t.createElementVNode("span",{class:"fas fa-info-circle no-border small"},null,-1)],Nn=t.createElementVNode("th",null,null,-1),Bn=["onClick"],Cn=["colspan"],Mn=t.createElementVNode("span",{class:"fas fa-plus-circle"},null,-1);function Dn(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.internalSchema.displayName?(t.openBlock(),t.createElementBlock("h2",vn,t.toDisplayString(e.$filters.capitalize(e.internalSchema.displayName)),1)):t.createCommentVNode("v-if",!0),t.createElementVNode("table",bn,[t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema.metadata.fields,i=>(t.openBlock(),t.createElementBlock("th",{key:e.generateGuid(i)},[t.createTextVNode(t.toDisplayString(e.$filters.capitalize(i.displayName))+" ",1),i.metadata.hint?(t.openBlock(),t.createElementBlock("span",{key:0,"data-tooltip":i.metadata.hint,"data-tooltip-size":"extra-large"},wn,8,$n)):t.createCommentVNode("v-if",!0)]))),128)),Nn])]),t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalModel,(i,l)=>(t.openBlock(),t.createElementBlock("tr",{key:e.generateGuid(i)},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema.metadata.fields,d=>(t.openBlock(),t.createElementBlock("td",{key:e.generateGuid(d)},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(e.getFieldType(d)),{schema:d,model:e.getModelValue(d,i),label:!1,onChanged:m=>e.setModelValue(d,i,m),onClick:e.buttonClicked,onError:e.error,onException:e.exception},null,40,["schema","model","onChanged","onClick","onError","onException"]))]))),128)),t.createElementVNode("td",null,[t.createElementVNode("a",{class:"fas fa-minus-circle",onClick:t.withModifiers(d=>e.removeItem(i),["stop","prevent"])},null,8,Bn)])]))),128))]),t.createElementVNode("tfoot",null,[t.createElementVNode("tr",null,[t.createElementVNode("td",{colspan:e.internalSchema.metadata.fields.length+1},[t.createElementVNode("a",{onClick:n[0]||(n[0]=t.withModifiers((...i)=>e.addItem&&e.addItem(...i),["stop","prevent"]))},[Mn,t.createTextVNode("Add More")])],8,Cn)])])])])}const Tn=h(En,[["render",Dn]]),Fn=t.defineComponent({methods:{findTab:function(e){return!this.sections||this.sections.length===0?null:(e||(e=this.sections[0].name),this.sections.filter(n=>n.name===e)[0])},switchSelected:function(e){this.sectionPicked=this.findTab(e),this.switchTabs(),this.$emit("section-changed",this.sectionPicked)},switchTabs:function(){if(!(!this.sections||this.sections.length===0)&&(this.sections.some(e=>e===this.sectionPicked)||(this.sectionPicked=this.sections[0]),!!this.sectionPicked)){for(let e=0;e<this.sections.length;++e)this.sections[e].selected=!1;this.sectionPicked.selected=!0}}},props:{initialSectionPicked:{type:String,default:""},sections:{type:Array,default:[]}},watch:{sections:function(e){var n;this.switchSelected((n=this.sectionPicked)==null?void 0:n.name)},initialSectionPicked:function(e){this.switchSelected(this.initialSectionPicked)}},data(){return{sectionPicked:this.findTab(this.initialSectionPicked)}},beforeMount:function(){this.switchSelected(this.initialSectionPicked)}}),In={class:"tabs"},qn={class:"row flex align-items-stretch"},jn=["onClick"];function Ln(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",In,[t.createElementVNode("header",null,[t.createElementVNode("ul",qn,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.sections,(i,l)=>(t.openBlock(),t.createElementBlock("li",{key:l},[t.createElementVNode("a",{href:"#!",onClick:t.withModifiers(d=>e.switchSelected(i.name),["stop","prevent"]),class:t.normalizeClass(["tab",{selected:i.selected}])},[t.createElementVNode("span",{class:t.normalizeClass(["fas",[i.icon]])},null,2),t.createTextVNode(" "+t.toDisplayString(i.name),1)],10,jn)]))),128))])]),t.createElementVNode("section",null,[t.renderSlot(e.$slots,"default")])])}const An=h(Fn,[["render",Ln]]),On=t.defineComponent({components:{tabs:An},data(){return{internalModel:this.model,tabPicked:this.schema.tabs[0]}},props:{model:Object,schema:Object,idSuffix:String},methods:{getFieldType:function(e){return e.type.indexOf("form-field-")==0?e.type:"form-field-"+e.type},getModelValue:function(e){return this.internalModel[this.tabPicked.model][e.model]},setModelValue:function(e,n){this.internalModel[this.tabPicked.model][n.model]=e,this.$emit("changed",this.internalModel,this.schema)},error:function(e){this.$emit("error",e)},exception:function(e){this.$emit("exception",e)},buttonClicked:function(e,n){this.$emit("click",e,n)},getSchema:function(e){return e},tabChanged:function(e){this.tabPicked=e},getFields:function(){return this.tabPicked.fields},getIDSuffix:function(e){return this.idSuffix===void 0?"":this.idSuffix},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)}}});function Pn(e,n,a,r,o,s){const i=t.resolveComponent("tabs");return t.openBlock(),t.createElementBlock("div",null,[t.createTextVNode(" Complex Tabs "),t.createVNode(i,{sections:e.schema.tabs,onSectionChanged:e.tabChanged,class:t.normalizeClass(e.schema.tabClasses)},{default:t.withCtx(()=>[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.getFields(),l=>(t.openBlock(),t.createElementBlock("div",{key:e.generateGuid(l)},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(e.getFieldType(l)),{schema:e.getSchema(l),model:e.getModelValue(l),"id-suffix":e.getIDSuffix(l),onChanged:e.setModelValue,onClick:e.buttonClicked,onError:e.error,onException:e.exception},null,40,["schema","model","id-suffix","onChanged","onClick","onError","onException"]))]))),128))]),_:1},8,["sections","onSectionChanged","class"])])}const zn=h(On,[["render",Pn]]),Rn=t.defineComponent({data:function(){let e={};for(let n in this.model[0])this.model[0].hasOwnProperty(n)&&(e[n]="");return{internalModel:this.model,defaultItem:e}},props:{model:Object,schema:Object,idSuffix:String},methods:{getFieldType:function(e){return e.type.indexOf("form-field-")==0?e.type:"form-field-"+e.type},getModelValue:function(e,n){return n[e.model]},setModelValue:function(e,n,a){n[e.model]=a,this.$emit("changed",this.internalModel,this.schema)},error:function(e){this.$emit("error",e)},exception:function(e){this.$emit("exception",e)},buttonClicked:function(e,n){this.$emit("click",e,n)},getSchema:function(e){return e},removeItem:function(e){if(this.schema.confirmRemoval&&!confirm("Are you sure you want to remove this item?"))return;this.internalModel||(this.internalModel=[]);let n=this.internalModel.indexOf(e);this.internalModel.splice(n,1),this.$emit("changed",this.internalModel,this.schema)},addItem:function(e){this.internalModel||(this.internalModel=[]),this.internalModel=this.internalModel.concat(Object.assign({},this.defaultItem)),this.$emit("changed",this.internalModel,this.schema)},getIDSuffix:function(e,n){return this.idSuffix===void 0?n:this.idSuffix+n},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)}}}),Un=["onClick"],Yn=t.createElementVNode("span",{class:"fas fa-plus-circle"},null,-1);function Hn(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createTextVNode(" Complex Repeater "),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalModel,(i,l)=>(t.openBlock(),t.createElementBlock("div",{key:e.generateGuid(i),class:"border-bottom"},[t.createElementVNode("a",{class:"fas fa-minus-circle right",onClick:t.withModifiers(d=>e.removeItem(i),["stop","prevent"])},null,8,Un),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.schema.fields,d=>(t.openBlock(),t.createElementBlock("div",{key:e.generateGuid(d)},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(e.getFieldType(d)),{schema:e.getSchema(d),model:e.getModelValue(d,i),label:!0,"id-suffix":e.getIDSuffix(d,l),onChanged:m=>e.setModelValue(d,i,m),onClick:e.buttonClicked,onError:e.error,onException:e.exception},null,40,["schema","model","id-suffix","onChanged","onClick","onError","onException"]))]))),128))]))),128)),t.createElementVNode("a",{onClick:n[0]||(n[0]=t.withModifiers((...i)=>e.addItem&&e.addItem(...i),["stop","prevent"]))},[Yn,t.createTextVNode("Add More")])])}const Kn=h(Rn,[["render",Hn]]),Gn=t.defineComponent({name:"form-field-complex",components:{"form-field-complex-conditional":Sn,"form-field-complex-list":Tn,"form-field-complex-tabs":zn,"form-field-input":R,"form-field-select":H,"form-field-checkbox":K,"form-field-radio":G,"form-field-textarea":Q,"form-field-text":J,"form-field-upload":W,"form-field-buttons":Z,"form-field-complex-repeater":Kn,"form-field-markdown":U,"form-field-html":Y},data:function(){return{internalModel:this.model,internalSchema:this.schema}},props:{model:{type:Object,default:{}},schema:{type:Object,default:{fields:[]}}},methods:{error:function(e){this.$emit("error",e)},exception:function(e){this.$emit("exception",e)},setModelValue:function(e,n){this.internalModel[n.propertyName]=e,this.$emit("changed",this.internalModel,this.schema)},buttonClicked:function(e,n){this.$emit("click",e,n)},generateGuid:function(e){let n=e.key;if(n)return n;let a="";for(let r=0;r<32;r++){let o=Math.floor(Math.random()*16).toString(16).toUpperCase();a=a+o}return e.key=a,e.key}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)},schema:function(e,n){n!==e&&(this.internalSchema=e)}}});function Qn(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[e.internalModel?(t.openBlock(!0),t.createElementBlock(t.Fragment,{key:0},t.renderList(e.internalSchema.fields,i=>(t.openBlock(),t.createElementBlock("div",{key:e.generateGuid(i)},[(t.openBlock(),t.createBlock(t.resolveDynamicComponent("form-field-"+i.propertyType),{schema:i,model:e.internalModel[i.propertyName],onChanged:e.setModelValue,onClick:e.buttonClicked,onError:e.error,onException:e.exception},null,40,["schema","model","onChanged","onClick","onError","onException"]))]))),128)):t.createCommentVNode("v-if",!0)])}const Jn=h(Gn,[["render",Qn]]),Wn=t.defineComponent({name:"mithril-form",components:{"form-field-complex":Jn},data:function(){return{submitting:!1,internalModel:JSON.parse(JSON.stringify(this.model)),internalSchema:{fields:this.schema},formID:"mithril-form-"+Math.floor(Math.random()*1e9),valid:!1}},props:{schema:{type:Array,default:[]},model:{type:Object,default:{}},action:{default:"",type:String},ajaxAction:{default:"",type:String},encoding:{default:"multipart/form-data",type:String},debug:{default:!0,type:Boolean}},methods:{revalidate:async function(){return this.valid=await le.validateForm(document.getElementById(this.formID)),this.valid},setModelValue:function(e,n){this.internalModel=e,this.revalidate(),this.$emit("changed",this.internalModel)},error:function(e){this.$emit("error",e)},exception:function(e){this.$emit("exception",e)},buttonClicked:function(e,n){this.revalidate(),this.$emit("click",e,n)},reset:function(){let e=this;c.debug("Resetting form to state:",e.model),e.internalModel=JSON.parse(JSON.stringify(e.model)),setTimeout(function(){e.revalidate()},100)},submit:function(e){let n=this;return!n.revalidate()||n.submitting?(e.preventDefault(),!1):(n.submitting=!0,n.ajaxAction?(c.debug("Submitting form to location: ",{location:n.ajaxAction}),p.post(n.ajaxAction,n.internalModel).onSuccess(function(a){n.submitting=!1,n.$emit("success",a)}).onError(function(a){n.submitting=!1,n.$emit("error",a)}).send(),e.preventDefault(),!1):(this.$emit("submit",e,n.internalModel),e.preventDefault(),!1))},getIDSuffix:function(){return""}},watch:{schema:function(e,n){n!==e&&(this.internalSchema=e,this.internalModel!==null&&this.$nextTick(()=>{this.revalidate()}))},model:function(e,n){n!==e&&(this.internalModel=e,e!==null&&this.$nextTick(()=>{this.revalidate()}))}},mounted:function(){this.$nextTick(function(){this.revalidate()})}}),M=e=>(t.pushScopeId("data-v-3876a27d"),e=e(),t.popScopeId(),e),Zn=["action","enctype","id"],Xn={key:0,class:"panel error"},_n=[M(()=>t.createElementVNode("header",null,"Oops, some form elements have problems",-1)),M(()=>t.createElementVNode("div",{class:"body"}," We're sorry but some of the fields are having issues. ",-1))],xn={class:"input-group"},Vn=["disabled","value"],ea=["disabled"],ta={key:1,class:"flex row no-wrap"},na={class:"panel"},aa=M(()=>t.createElementVNode("header",null,"Form Schema",-1)),ra={class:"body"},ia={class:"panel"},oa=M(()=>t.createElementVNode("header",null,"Form Model",-1)),sa={class:"body",style:{"word-wrap":"break-word"}};function la(e,n,a,r,o,s){const i=t.resolveComponent("form-field-complex");return t.openBlock(),t.createElementBlock("form",{action:e.action,class:"stacked",onReset:n[0]||(n[0]=t.withModifiers((...l)=>e.reset&&e.reset(...l),["stop","prevent"])),onSubmit:n[1]||(n[1]=(...l)=>e.submit&&e.submit(...l)),method:"post",enctype:e.encoding,id:e.formID},[e.valid?t.createCommentVNode("v-if",!0):(t.openBlock(),t.createElementBlock("div",Xn,_n)),t.createVNode(i,{schema:e.internalSchema,model:e.internalModel,onChanged:e.setModelValue,onClick:e.buttonClicked,onError:e.error,onException:e.exception},null,8,["schema","model","onChanged","onClick","onError","onException"]),t.createElementVNode("div",null,[t.createElementVNode("div",xn,[t.createElementVNode("input",{type:"submit",disabled:e.submitting,value:e.submitting?"Submitting...":"Submit"},null,8,Vn),t.createElementVNode("input",{type:"reset",disabled:e.submitting,value:"Reset"},null,8,ea)])]),e.debug?(t.openBlock(),t.createElementBlock("div",ta,[t.createElementVNode("div",na,[aa,t.createElementVNode("div",ra,[t.createElementVNode("pre",null,"                        "+t.toDisplayString(e.internalSchema)+`
                    `,1)])]),t.createElementVNode("div",ia,[oa,t.createElementVNode("div",sa,[t.createElementVNode("pre",null,"                        "+t.toDisplayString(e.internalModel)+`
                    `,1)])])])):t.createCommentVNode("v-if",!0)],40,Zn)}const X=h(Wn,[["render",la],["__scopeId","data-v-3876a27d"]]),da=t.defineComponent({name:"settings-editor-component",components:{"mithril-form":X},data:function(){return{currentEntity:null,entityQuery:`query($entityType: String) {
                    entity(entityType: $entityType)
                }`}},methods:{close:function(){this.$emit("close")},loadData:N(async function(){let e=this;await p.post("/api/query",{query:e.entityQuery,variables:{entityType:e.schema.dataType}}).onSuccess(a=>{c.debug("Entity loaded successfully",a.data.entity),e.currentEntity=a.data.entity}).send()},100),saveEntity:function(e,n){let a=this;if(e.preventDefault(),n!=null)return this.currentEntity=null,c.debug(n),p.post("/api/command/v1/SaveModelCommand",{data:n,entityType:a.schema.dataType,id:n.iD}).onSuccess(r=>{c.debug("Entity saved successfully",r.data),a.close()}).onError(r=>{c.error("Error saving entity",r.data)}).send(),!1}},props:{name:{type:String,default:""},schema:{type:Object,default:{}},debug:{type:Boolean,default:!0}},created:function(){this.loadData()},watch:{schema:function(){this.loadData()}}}),ca={class:"body"},ma={key:0,class:"panel debug"},ha=t.createElementVNode("header",null,"Editor Schema",-1);function pa(e,n,a,r,o,s){const i=t.resolveComponent("mithril-form");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["panel",e.schema.class])},[t.createElementVNode("header",null,t.toDisplayString(e.name),1),t.createElementVNode("div",ca,[t.createElementVNode("div",null,[t.createVNode(i,{schema:e.schema.modelSchema,model:e.currentEntity,debug:e.debug,onSubmit:e.saveEntity},null,8,["schema","model","debug","onSubmit"])]),e.debug&&e.schema?(t.openBlock(),t.createElementBlock("div",ma,[ha,t.createElementVNode("pre",null,""+t.toDisplayString(e.schema)+`
            `,1)])):t.createCommentVNode("v-if",!0)])],2)}const fa=h(da,[["render",pa]]);class _{constructor(n,a,r,o,s){this.filter=n,this.pageSize=a,this.page=r,this.sortField=o,this.sortAscending=s}}const ua=t.defineComponent({name:"mithril-listing",data:function(){return{internalModel:this.model,internalSchema:this.schema.filter(e=>{var n;return((n=e.metadata)==null?void 0:n.canList)??!0}),filter:"",pageSize:10,page:0,sortField:"",sortAscending:!1}},props:{model:{type:Object,default:{}},schema:{type:Array,default:[]},debug:{type:Boolean,default:!1}},methods:{filterData:N(function(e){let n=this;n.$emit("filter",e,new _(n.filter,n.pageSize,n.page,n.sortField,n.sortAscending))},300),entitySelected:function(e){this.$emit("entity-selected",e)}},watch:{model:function(e,n){n!==e&&(this.internalModel=e)},schema:function(e,n){n!==e&&(this.internalSchema=e.filter(a=>{var r;return((r=a.metadata)==null?void 0:r.canList)??!0}))}}}),q=e=>(t.pushScopeId("data-v-f557b045"),e=e(),t.popScopeId(),e),ga={class:"flex row"},ya={class:"right"},ka=[t.createStaticVNode('<option value="10" data-v-f557b045>10</option><option value="25" data-v-f557b045>25</option><option value="50" data-v-f557b045>50</option><option value="100" data-v-f557b045>100</option><option value="-1" data-v-f557b045>All</option>',5)],Sa=q(()=>t.createElementVNode("br",{class:"clear"},null,-1)),Ea=["onClick"],va={key:0,class:"flex row"},ba={class:"panel"},$a=q(()=>t.createElementVNode("header",null,"Listing Schema",-1)),wa={class:"body"},Na={class:"panel"},Ba=q(()=>t.createElementVNode("header",null,"Listing Model",-1)),Ca={class:"body"};function Ma(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createElementVNode("div",ga,[t.withDirectives(t.createElementVNode("input",{type:"text",placeholder:"Find an item",onKeyup:n[0]||(n[0]=(...i)=>e.filterData&&e.filterData(...i)),"onUpdate:modelValue":n[1]||(n[1]=i=>e.filter=i)},null,544),[[t.vModelText,e.filter]]),t.createElementVNode("div",null,[t.createElementVNode("label",ya,[t.createTextVNode(" Show "),t.withDirectives(t.createElementVNode("select",{"onUpdate:modelValue":n[2]||(n[2]=i=>e.pageSize=i),onChange:n[3]||(n[3]=(...i)=>e.filterData&&e.filterData(...i))},ka,544),[[t.vModelSelect,e.pageSize]]),t.createTextVNode(" Records ")])])]),Sa,t.createElementVNode("table",null,[t.createElementVNode("thead",null,[t.createElementVNode("tr",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema,i=>(t.openBlock(),t.createElementBlock("th",{key:i.propertyName},t.toDisplayString(i.displayName),1))),128))])]),t.createElementVNode("tbody",null,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalModel,i=>(t.openBlock(),t.createElementBlock("tr",{key:i.id},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.internalSchema,l=>(t.openBlock(),t.createElementBlock("td",{key:l.propertyName},[t.createElementVNode("a",{onClick:d=>e.entitySelected(i)},t.toDisplayString(i[l.propertyName]),9,Ea)]))),128))]))),128))])]),e.debug?(t.openBlock(),t.createElementBlock("div",va,[t.createElementVNode("div",ba,[$a,t.createElementVNode("div",wa,[t.createElementVNode("pre",null,"                        "+t.toDisplayString(e.internalSchema)+`
                    `,1)])]),t.createElementVNode("div",Na,[Ba,t.createElementVNode("div",Ca,[t.createElementVNode("pre",null,"                        "+t.toDisplayString(e.internalModel)+`
                    `,1)])])])):t.createCommentVNode("v-if",!0)])}const Da=h(ua,[["render",Ma],["__scopeId","data-v-f557b045"]]),Ta=t.defineComponent({name:"data-editor-component",components:{listing:Da,"mithril-form":X},data:function(){return{entities:[],mode:"listing",currentEntity:null,entitiesQuery:`query($entityType: String, $pageSize: Int, $page: Int, $sortField: String, $sortAscending: Boolean, $filter: String) {
                    entities(entityType: $entityType, pageSize: $pageSize, page: $page, sortField: $sortField, sortAscending: $sortAscending, filter: $filter)
                }`,currentFilter:new _("",10,0,"",!1),currentRequest:null,entityQuery:`query($entityType: String, $id: Long) {
                    entity(entityType: $entityType, id: $id)
                }`}},methods:{editEntity:async function(e){let n=this;c.debug("Editing entity",e),await p.post("/api/query",{query:n.entityQuery,variables:{entityType:n.schema.dataType,id:e.iD}}).onSuccess(r=>{c.debug("Entity loaded successfully",r.data.entity),n.currentEntity=r.data.entity,this.mode="editor"}).send()},filter:function(e,n){this.currentFilter=n,this.loadData()},loadData:N(async function(){let e=this;e.currentRequest!=null&&(e.cancellationToken.canceled=!0),e.cancellationToken=new se,e.currentRequest=p.post("/api/query",{query:e.entitiesQuery,variables:{entityType:e.schema.dataType,pageSize:Number.parseInt(e.currentFilter.pageSize),page:Number.parseInt(e.currentFilter.page),sortField:e.currentFilter.sortField,sortAscending:e.currentFilter.sortAscending,filter:e.currentFilter.filter}}).withCancellationToken(e.cancellationToken).onSuccess(n=>{c.debug("Entities loaded successfully",n.data.entities),e.entities=n.data.entities}),await e.currentRequest.send()},100),openListing:function(){c.debug("Opening listing"),this.mode="listing",this.loadData()},saveEntity:function(e,n){let a=this;if(e.preventDefault(),n!=null)return this.currentEntity=null,c.debug("Saving entity:",n),p.post("/api/command/v1/SaveModelCommand",{data:n,entityType:a.schema.dataType,id:n.iD}).onSuccess(r=>{c.debug("Entity saved successfully",r.data),a.mode="listing",a.loadData()}).onError(r=>c.error("Error saving entity",r)).send(),!1}},props:{name:{type:String,default:""},schema:{type:Object,default:{}},debug:{type:Boolean,default:!0}},created:function(){this.openListing(),this.loadData()},watch:{schema:function(){this.openListing(),this.loadData()}}}),j=e=>(t.pushScopeId("data-v-20825e2b"),e=e(),t.popScopeId(),e),Fa=["title"],Ia=[j(()=>t.createElementVNode("span",{class:"fas fa-plus right"},null,-1))],qa=[j(()=>t.createElementVNode("span",{class:"fas fa-list right"},null,-1))],ja={class:"body"},La={key:0},Aa={key:1},Oa={key:2,class:"panel debug"},Pa=j(()=>t.createElementVNode("header",null,"Editor Schema",-1));function za(e,n,a,r,o,s){const i=t.resolveComponent("listing"),l=t.resolveComponent("mithril-form");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["panel",e.schema.class])},[t.createElementVNode("header",null,[t.createTextVNode(t.toDisplayString(e.name)+" ",1),e.mode=="listing"?(t.openBlock(),t.createElementBlock("a",{key:0,onClick:n[0]||(n[0]=d=>e.editEntity({iD:0})),title:"Add New "+e.name},Ia,8,Fa)):t.createCommentVNode("v-if",!0),e.mode=="editor"?(t.openBlock(),t.createElementBlock("a",{key:1,onClick:n[1]||(n[1]=(...d)=>e.openListing&&e.openListing(...d)),title:"Show Listing"},qa)):t.createCommentVNode("v-if",!0)]),t.createElementVNode("div",ja,[e.mode=="listing"?(t.openBlock(),t.createElementBlock("div",La,[t.createVNode(i,{schema:e.schema.modelSchema,model:e.entities,debug:e.debug,onEntitySelected:e.editEntity,onFilter:e.filter},null,8,["schema","model","debug","onEntitySelected","onFilter"])])):t.createCommentVNode("v-if",!0),e.mode=="editor"?(t.openBlock(),t.createElementBlock("div",Aa,[t.createVNode(l,{schema:e.schema.modelSchema,model:e.currentEntity,debug:e.debug,onSubmit:e.saveEntity},null,8,["schema","model","debug","onSubmit"])])):t.createCommentVNode("v-if",!0),e.debug&&e.schema?(t.openBlock(),t.createElementBlock("div",Oa,[Pa,t.createElementVNode("pre",null,""+t.toDisplayString(e.schema)+`
                `,1)])):t.createCommentVNode("v-if",!0)])],2)}const Ra=h(Ta,[["render",za],["__scopeId","data-v-20825e2b"]]),Ua=t.defineComponent({name:"admin-application",computed:{groupedEditors:function(){const e={};return this.sortedEditors.forEach(n=>{e[n.category]||(e[n.category]=[]),e[n.category].push(n)}),Object.keys(e).map(n=>({category:n,editors:e[n]}))},sortedEditors:function(){return this.editors.sort((e,n)=>e.category<n.category?-1:e.category>n.category?1:e.name<n.name?-1:e.name>n.name?1:0)}},data:function(){return{editors:[],currentEditor:null}},methods:{close:function(){this.editorSelected(null)},editorSelected:function(e){this.debug&&c.debug("Switching to editor:",(e==null?void 0:e.name)??""),this.currentEditor=e},loadEditors:function(){this.debug&&c.debug("Loading Editors");let e=this;p.post("/api/query",{query:`query{
  editors {
    category
    componentDefinition {
      name
      schema
      scriptFile
    }
    description
    icon
    name
  }
}`}).onSuccess(n=>{e.editors=n.data.editors,e.debug&&c.debug("Finished loading editors:",n.data.editors)}).withStorageMode(b.StorageAndUpdate).send()}},props:{debug:{type:Boolean,default:!0}},created:function(){this.loadEditors()}}),Ya=e=>(t.pushScopeId("data-v-3ab6c12a"),e=e(),t.popScopeId(),e),Ha={class:"main-application"},Ka={class:"left-nav panel"},Ga={class:"menu"},Qa=["onClick","title"],Ja={class:"editor-content"},Wa={key:1,class:"panel debug"},Za=Ya(()=>t.createElementVNode("header",null,"Selected Editor Info",-1));function Xa(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",Ha,[t.createElementVNode("div",Ka,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.groupedEditors,i=>(t.openBlock(),t.createElementBlock("section",{key:i.category},[t.createElementVNode("header",null,t.toDisplayString(e.$filters.capitalize(i.category)),1),t.createElementVNode("ul",Ga,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(i.editors,(l,d)=>(t.openBlock(),t.createElementBlock("li",{key:l.name},[t.createElementVNode("a",{href:"#!",onClick:t.withModifiers(m=>e.editorSelected(l),["stop","prevent"]),title:l.description,class:t.normalizeClass({selected:e.currentEditor==l})},[t.createElementVNode("span",{class:t.normalizeClass(l.icon)},null,2),t.createTextVNode(t.toDisplayString(l.name),1)],10,Qa)]))),128))])]))),128))]),t.createElementVNode("div",Ja,[e.currentEditor?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(e.currentEditor.componentDefinition.schema.type),{key:0,schema:e.currentEditor.componentDefinition.schema,name:e.currentEditor.name,debug:e.debug,onError:e.error,onClose:e.close},null,40,["schema","name","debug","onError","onClose"])):t.createCommentVNode("v-if",!0),e.debug&&e.currentEditor?(t.openBlock(),t.createElementBlock("div",Wa,[Za,t.createElementVNode("ul",null,[t.createElementVNode("li",null," Component Name: "+t.toDisplayString(e.currentEditor.componentDefinition.name),1),t.createElementVNode("li",null," Component Type: "+t.toDisplayString(e.currentEditor.componentDefinition.schema.type),1)])])):t.createCommentVNode("v-if",!0)])])}const _a=h(Ua,[["render",Xa],["__scopeId","data-v-3ab6c12a"]]);let k={mounted:function(e,n){if(k.onEventBound=k.onEvent.bind({el:e}),document.addEventListener("click",k.onEventBound),typeof n.value!="function")throw new Error("Argument must be a function");k.cb=n.value},cb:function(e){},onEvent:function(e){e.target===this.el||this.el.contains(e.target)||!k.cb||k.cb(e)},onEventBound:function(){},unbind:function(){document.removeEventListener("click",k.onEventBound)},update:function(e,n){if(typeof n.value!="function")throw new Error("Argument must be a function");k.cb=n.value}};function xa(e){return e.directive("click-outside",k),e}function Va(e){return e==null||(e.config.globalProperties.$filters={moment:function(n,a,r){return n==null?"N/A":(r??(r="YYYY-MM-DDThh:mm:ss"),a??(a="M-D-YYYY h:mm A"),f(n,r).format(a))},capitalize:function(n){return n==null?"":n.charAt(0).toUpperCase()+n.slice(1)},maxsize:function(n,a,r){return n==null?"":n.length<=a?n:(r??(r="..."),n.substring(0,a)+r)},currency:function(n,a,r){return n==null?"":(a??(a="en-US"),r??(r={style:"currency",currency:"USD"}),Intl.NumberFormat(a,r).format(n))}}),e}class x{}const er=t.defineComponent({name:"DataHandler",data:function(){return{count:0,timer:0,internalData:this.model}},props:{model:{type:Object,default:{}},schema:{type:x,default:new x}},methods:{fetchData:function(){if(!this.schema.loadUrl)return;let e=this;p.post("/api/query",{query:e.schema.datalistQuery}).onSuccess(n=>{e.schema.datalist=n.data.dropDown}).withStorageMode(b.StorageAndUpdate).send()},saveData:function(){},deleteData:function(){}},created:function(){if(!this.schema.datalistQuery)return;this.fetchData()},watch:{model:function(e,n){n!==e&&(this.internalModel=e)}}});function tr(e,n,a,r,o,s){return t.openBlock(),t.createElementBlock("div",null,[t.createTextVNode(" ASDF "),(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.schema.children,i=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(i.type),{key:i.type,data:e.internalData,schema:i,onSave:e.saveData,onDelete:e.deleteData,onLoad:e.fetchData},null,40,["data","schema","onSave","onDelete","onLoad"]))),128)),t.createElementVNode("pre",null,t.toDisplayString(e.internalData),1)])}const nr=h(er,[["render",tr]]),ar=t.defineComponent({data:function(){return{items:this.items,showDropDown:!1}},props:{items:Array},methods:{showDropDownFunc:function(){this.showDropDown=!0},hideDropDownFunc:function(){this.showDropDown=!1}},directives:{clickOutside:k}}),rr={class:"unstyled"},ir={class:"grouped"},or=["href"];function sr(e,n,a,r,o,s){const i=t.resolveDirective("click-outside");return t.withDirectives((t.openBlock(),t.createElementBlock("ul",rr,[t.createElementVNode("li",null,[t.createElementVNode("a",{class:"fas fa-circle-user",href:"#",onClick:n[0]||(n[0]=t.withModifiers((...l)=>e.showDropDownFunc&&e.showDropDownFunc(...l),["stop","prevent"]))}),t.createElementVNode("div",{class:t.normalizeClass({show:e.showDropDown,"z-depth-2":e.showDropDown,hidden:!e.showDropDown})},[t.createElementVNode("ul",ir,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(e.items,l=>(t.openBlock(),t.createElementBlock("li",{key:l.display},[t.createElementVNode("a",{href:l.url,class:t.normalizeClass([l.icon])},t.toDisplayString(l.display),11,or)]))),128))])],2)])])),[[i,e.hideDropDownFunc]])}const lr=h(ar,[["render",sr]]),dr=e=>{e.component("mithril-data-handler",nr),e.component("mithril-side-menu",lr)},cr={install:(e,n)=>{Va(e),xa(e),dr(e)}};class mr{constructor(){te(this,"AdminApp");c.debug("Admin loading"),this.AdminApp=this.SetupComponents(t.createApp({data:function(){return{}}})),this.AdminApp.mount("#AdminApplication"),c.debug("Admin loaded")}SetupComponents(n){return n.use(cr),n.component("admin-application",_a),n.component("settings-editor-component",fa),n.component("data-editor-component",Ra),n}}return(()=>{new mr})()});
